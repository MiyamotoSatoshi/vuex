export function createSimpleFunctional(c, el = 'div', name) {
    return {
        name: name || c.replace(/__/g, '-'),
        functional: true,
        render(h, { data, children }) {
            data.staticClass = (`${c} ${data.staticClass || ''}`).trim();
            return h(el, data, children);
        }
    };
}
function mergeTransitions(transitions, array) {
    if (Array.isArray(transitions))
        return transitions.concat(array);
    if (transitions)
        array.push(transitions);
    return array;
}
export function createSimpleTransition(name, origin = 'top center 0', mode) {
    return {
        name,
        functional: true,
        props: {
            group: {
                type: Boolean,
                default: false
            },
            hideOnLeave: {
                type: Boolean,
                default: false
            },
            leaveAbsolute: {
                type: Boolean,
                default: false
            },
            mode: {
                type: String,
                default: mode
            },
            origin: {
                type: String,
                default: origin
            }
        },
        render(h, context) {
            const tag = `transition${context.props.group ? '-group' : ''}`;
            context.data = context.data || {};
            context.data.props = {
                name,
                mode: context.props.mode
            };
            context.data.on = context.data.on || {};
            if (!Object.isExtensible(context.data.on)) {
                context.data.on = { ...context.data.on };
            }
            const ourBeforeEnter = [];
            const ourLeave = [];
            const absolute = (el) => (el.style.position = 'absolute');
            ourBeforeEnter.push((el) => {
                el.style.transformOrigin = context.props.origin;
                el.style.webkitTransformOrigin = context.props.origin;
            });
            if (context.props.leaveAbsolute)
                ourLeave.push(absolute);
            if (context.props.hideOnLeave) {
                ourLeave.push((el) => (el.style.display = 'none'));
            }
            const { beforeEnter, leave } = context.data.on;
            // Type says Function | Function[] but
            // will only work if provided a function
            context.data.on.beforeEnter = () => mergeTransitions(beforeEnter, ourBeforeEnter);
            context.data.on.leave = mergeTransitions(leave, ourLeave);
            return h(tag, context.data, context.children);
        }
    };
}
export function createJavaScriptTransition(name, functions, mode = 'in-out') {
    return {
        name,
        functional: true,
        props: {
            mode: {
                type: String,
                default: mode
            }
        },
        render(h, context) {
            const data = {
                props: {
                    ...context.props,
                    name
                },
                on: functions
            };
            return h('transition', data, context.children);
        }
    };
}
export function directiveConfig(binding, defaults = {}) {
    return {
        ...defaults,
        ...binding.modifiers,
        value: binding.arg,
        ...(binding.value || {})
    };
}
export function addOnceEventListener(el, event, cb) {
    var once = () => {
        cb();
        el.removeEventListener(event, once, false);
    };
    el.addEventListener(event, once, false);
}
export function getNestedValue(obj, path, fallback) {
    const last = path.length - 1;
    if (last < 0)
        return obj === undefined ? fallback : obj;
    for (let i = 0; i < last; i++) {
        if (obj == null) {
            return fallback;
        }
        obj = obj[path[i]];
    }
    if (obj == null)
        return fallback;
    return obj[path[last]] === undefined ? fallback : obj[path[last]];
}
export function deepEqual(a, b) {
    if (a === b)
        return true;
    if (a instanceof Date && b instanceof Date) {
        // If the values are Date, they were convert to timestamp with getTime and compare it
        if (a.getTime() !== b.getTime())
            return false;
    }
    if (a !== Object(a) || b !== Object(b)) {
        // If the values aren't objects, they were already checked for equality
        return false;
    }
    const props = Object.keys(a);
    if (props.length !== Object.keys(b).length) {
        // Different number of props, don't bother to check
        return false;
    }
    return props.every(p => deepEqual(a[p], b[p]));
}
export function getObjectValueByPath(obj, path, fallback) {
    // credit: http://stackoverflow.com/questions/6491463/accessing-nested-javascript-objects-with-string-key#comment55278413_6491621
    if (!path || path.constructor !== String)
        return fallback;
    path = path.replace(/\[(\w+)\]/g, '.$1'); // convert indexes to properties
    path = path.replace(/^\./, ''); // strip a leading dot
    return getNestedValue(obj, path.split('.'), fallback);
}
export function getPropertyFromItem(item, property, fallback) {
    if (property == null)
        return item === undefined ? fallback : item;
    if (item !== Object(item))
        return fallback === undefined ? item : fallback;
    if (typeof property === 'string')
        return getObjectValueByPath(item, property, fallback);
    if (Array.isArray(property))
        return getNestedValue(item, property, fallback);
    if (typeof property !== 'function')
        return fallback;
    const value = property(item, fallback);
    return typeof value === 'undefined' ? fallback : value;
}
export function createRange(length) {
    return Array.from({ length }, (v, k) => k);
}
export function getZIndex(el) {
    if (!el || el.nodeType !== Node.ELEMENT_NODE)
        return 0;
    const index = +window.getComputedStyle(el).getPropertyValue('z-index');
    if (isNaN(index))
        return getZIndex(el.parentNode);
    return index;
}
const tagsToReplace = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;'
};
export function escapeHTML(str) {
    return str.replace(/[&<>]/g, tag => tagsToReplace[tag] || tag);
}
export function filterObjectOnKeys(obj, keys) {
    const filtered = {};
    for (let i = 0; i < keys.length; i++) {
        const key = keys[i];
        if (typeof obj[key] !== 'undefined') {
            filtered[key] = obj[key];
        }
    }
    return filtered;
}
export function filterChildren(array = [], tag) {
    return array.filter(child => {
        return child.componentOptions &&
            child.componentOptions.Ctor.options.name === tag;
    });
}
export function convertToUnit(str, unit = 'px') {
    if (str == null || str === '') {
        return undefined;
    }
    else if (isNaN(+str)) {
        return String(str);
    }
    else {
        return `${Number(str)}${unit}`;
    }
}
export function kebabCase(str) {
    return (str || '').replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
}
export function isObject(obj) {
    return obj !== null && typeof obj === 'object';
}
// KeyboardEvent.keyCode aliases
export const keyCodes = Object.freeze({
    enter: 13,
    tab: 9,
    delete: 46,
    esc: 27,
    space: 32,
    up: 38,
    down: 40,
    left: 37,
    right: 39,
    end: 35,
    home: 36,
    del: 46,
    backspace: 8,
    insert: 45,
    pageup: 33,
    pagedown: 34
});
const ICONS_PREFIX = '$vuetify.icons.';
// This remaps internal names like '$vuetify.icons.cancel' to the current name
// for that icon.
export function remapInternalIcon(vm, iconName) {
    if (!iconName.startsWith(ICONS_PREFIX)) {
        return iconName;
    }
    // Now look up icon indirection name, e.g. '$vuetify.icons.cancel'
    return getObjectValueByPath(vm, iconName, iconName);
}
export function keys(o) {
    return Object.keys(o);
}
/**
 * Camelize a hyphen-delimited string.
 */
const camelizeRE = /-(\w)/g;
export const camelize = (str) => {
    return str.replace(camelizeRE, (_, c) => c ? c.toUpperCase() : '');
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL2hlbHBlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsTUFBTSxVQUFVLHNCQUFzQixDQUNwQyxDQUFTLEVBQ1QsRUFBRSxHQUFHLEtBQUssRUFDVixJQUFhO0lBRWIsT0FBTztRQUNMLElBQUksRUFBRSxJQUFJLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDO1FBRW5DLFVBQVUsRUFBRSxJQUFJO1FBRWhCLE1BQU0sQ0FBRSxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFO1lBQzNCLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7WUFFNUQsT0FBTyxDQUFDLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQTtRQUM5QixDQUFDO0tBQ0YsQ0FBQTtBQUNILENBQUM7QUFFRCxTQUFTLGdCQUFnQixDQUN2QixXQUE4QyxFQUM5QyxLQUFpQjtJQUVqQixJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDO1FBQUUsT0FBTyxXQUFXLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBQ2hFLElBQUksV0FBVztRQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUE7SUFDeEMsT0FBTyxLQUFLLENBQUE7QUFDZCxDQUFDO0FBRUQsTUFBTSxVQUFVLHNCQUFzQixDQUNwQyxJQUFZLEVBQ1osTUFBTSxHQUFHLGNBQWMsRUFDdkIsSUFBYTtJQUViLE9BQU87UUFDTCxJQUFJO1FBRUosVUFBVSxFQUFFLElBQUk7UUFFaEIsS0FBSyxFQUFFO1lBQ0wsS0FBSyxFQUFFO2dCQUNMLElBQUksRUFBRSxPQUFPO2dCQUNiLE9BQU8sRUFBRSxLQUFLO2FBQ2Y7WUFDRCxXQUFXLEVBQUU7Z0JBQ1gsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsT0FBTyxFQUFFLEtBQUs7YUFDZjtZQUNELGFBQWEsRUFBRTtnQkFDYixJQUFJLEVBQUUsT0FBTztnQkFDYixPQUFPLEVBQUUsS0FBSzthQUNmO1lBQ0QsSUFBSSxFQUFFO2dCQUNKLElBQUksRUFBRSxNQUFNO2dCQUNaLE9BQU8sRUFBRSxJQUFJO2FBQ2Q7WUFDRCxNQUFNLEVBQUU7Z0JBQ04sSUFBSSxFQUFFLE1BQU07Z0JBQ1osT0FBTyxFQUFFLE1BQU07YUFDaEI7U0FDRjtRQUVELE1BQU0sQ0FBRSxDQUFDLEVBQUUsT0FBTztZQUNoQixNQUFNLEdBQUcsR0FBRyxhQUFhLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFBO1lBQzlELE9BQU8sQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUE7WUFDakMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUc7Z0JBQ25CLElBQUk7Z0JBQ0osSUFBSSxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSTthQUN6QixDQUFBO1lBQ0QsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFBO1lBQ3ZDLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQ3pDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFBO2FBQ3pDO1lBRUQsTUFBTSxjQUFjLEdBQWUsRUFBRSxDQUFBO1lBQ3JDLE1BQU0sUUFBUSxHQUFlLEVBQUUsQ0FBQTtZQUMvQixNQUFNLFFBQVEsR0FBRyxDQUFDLEVBQWUsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxVQUFVLENBQUMsQ0FBQTtZQUV0RSxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBZSxFQUFFLEVBQUU7Z0JBQ3RDLEVBQUUsQ0FBQyxLQUFLLENBQUMsZUFBZSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFBO2dCQUMvQyxFQUFFLENBQUMsS0FBSyxDQUFDLHFCQUFxQixHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFBO1lBQ3ZELENBQUMsQ0FBQyxDQUFBO1lBRUYsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLGFBQWE7Z0JBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtZQUN4RCxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFO2dCQUM3QixRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBZSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUE7YUFDaEU7WUFFRCxNQUFNLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFBO1lBRTlDLHNDQUFzQztZQUN0Qyx3Q0FBd0M7WUFDeEMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxHQUFHLEdBQUcsRUFBRSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsRUFBRSxjQUFjLENBQUMsQ0FBQTtZQUNqRixPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEdBQUcsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFBO1lBRXpELE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUMvQyxDQUFDO0tBQ0YsQ0FBQTtBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsMEJBQTBCLENBQ3hDLElBQVksRUFDWixTQUFvQyxFQUNwQyxJQUFJLEdBQUcsUUFBUTtJQUVmLE9BQU87UUFDTCxJQUFJO1FBRUosVUFBVSxFQUFFLElBQUk7UUFFaEIsS0FBSyxFQUFFO1lBQ0wsSUFBSSxFQUFFO2dCQUNKLElBQUksRUFBRSxNQUFNO2dCQUNaLE9BQU8sRUFBRSxJQUFJO2FBQ2Q7U0FDRjtRQUVELE1BQU0sQ0FBRSxDQUFDLEVBQUUsT0FBTztZQUNoQixNQUFNLElBQUksR0FBRztnQkFDWCxLQUFLLEVBQUU7b0JBQ0wsR0FBRyxPQUFPLENBQUMsS0FBSztvQkFDaEIsSUFBSTtpQkFDTDtnQkFDRCxFQUFFLEVBQUUsU0FBUzthQUNkLENBQUE7WUFFRCxPQUFPLENBQUMsQ0FBQyxZQUFZLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUNoRCxDQUFDO0tBQ0YsQ0FBQTtBQUNILENBQUM7QUFHRCxNQUFNLFVBQVUsZUFBZSxDQUFFLE9BQXNCLEVBQUUsUUFBUSxHQUFHLEVBQUU7SUFDcEUsT0FBTztRQUNMLEdBQUcsUUFBUTtRQUNYLEdBQUcsT0FBTyxDQUFDLFNBQVM7UUFDcEIsS0FBSyxFQUFFLE9BQU8sQ0FBQyxHQUFHO1FBQ2xCLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQztLQUN6QixDQUFBO0FBQ0gsQ0FBQztBQUVELE1BQU0sVUFBVSxvQkFBb0IsQ0FBRSxFQUFlLEVBQUUsS0FBYSxFQUFFLEVBQWM7SUFDbEYsSUFBSSxJQUFJLEdBQUcsR0FBRyxFQUFFO1FBQ2QsRUFBRSxFQUFFLENBQUE7UUFDSixFQUFFLENBQUMsbUJBQW1CLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQTtJQUM1QyxDQUFDLENBQUE7SUFFRCxFQUFFLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQTtBQUN6QyxDQUFDO0FBRUQsTUFBTSxVQUFVLGNBQWMsQ0FBRSxHQUFRLEVBQUUsSUFBeUIsRUFBRSxRQUFjO0lBQ2pGLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFBO0lBRTVCLElBQUksSUFBSSxHQUFHLENBQUM7UUFBRSxPQUFPLEdBQUcsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFBO0lBRXZELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDN0IsSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFO1lBQ2YsT0FBTyxRQUFRLENBQUE7U0FDaEI7UUFDRCxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0tBQ25CO0lBRUQsSUFBSSxHQUFHLElBQUksSUFBSTtRQUFFLE9BQU8sUUFBUSxDQUFBO0lBRWhDLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7QUFDbkUsQ0FBQztBQUVELE1BQU0sVUFBVSxTQUFTLENBQUUsQ0FBTSxFQUFFLENBQU07SUFDdkMsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUFFLE9BQU8sSUFBSSxDQUFBO0lBRXhCLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFlBQVksSUFBSSxFQUFFO1FBQzFDLHFGQUFxRjtRQUNyRixJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUMsT0FBTyxFQUFFO1lBQUUsT0FBTyxLQUFLLENBQUE7S0FDOUM7SUFFRCxJQUFJLENBQUMsS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRTtRQUN0Qyx1RUFBdUU7UUFDdkUsT0FBTyxLQUFLLENBQUE7S0FDYjtJQUVELE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFFNUIsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFO1FBQzFDLG1EQUFtRDtRQUNuRCxPQUFPLEtBQUssQ0FBQTtLQUNiO0lBRUQsT0FBTyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ2hELENBQUM7QUFFRCxNQUFNLFVBQVUsb0JBQW9CLENBQUUsR0FBVyxFQUFFLElBQVksRUFBRSxRQUFjO0lBQzdFLGlJQUFpSTtJQUNqSSxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssTUFBTTtRQUFFLE9BQU8sUUFBUSxDQUFBO0lBQ3pELElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQSxDQUFDLGdDQUFnQztJQUN6RSxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUEsQ0FBQyxzQkFBc0I7SUFDckQsT0FBTyxjQUFjLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUE7QUFDdkQsQ0FBQztBQUVELE1BQU0sVUFBVSxtQkFBbUIsQ0FDakMsSUFBWSxFQUNaLFFBQWdGLEVBQ2hGLFFBQWM7SUFFZCxJQUFJLFFBQVEsSUFBSSxJQUFJO1FBQUUsT0FBTyxJQUFJLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQTtJQUVqRSxJQUFJLElBQUksS0FBSyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQUUsT0FBTyxRQUFRLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQTtJQUUxRSxJQUFJLE9BQU8sUUFBUSxLQUFLLFFBQVE7UUFBRSxPQUFPLG9CQUFvQixDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFFdkYsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztRQUFFLE9BQU8sY0FBYyxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFFNUUsSUFBSSxPQUFPLFFBQVEsS0FBSyxVQUFVO1FBQUUsT0FBTyxRQUFRLENBQUE7SUFFbkQsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUV0QyxPQUFPLE9BQU8sS0FBSyxLQUFLLFdBQVcsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUE7QUFDeEQsQ0FBQztBQUVELE1BQU0sVUFBVSxXQUFXLENBQUUsTUFBYztJQUN6QyxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQzVDLENBQUM7QUFFRCxNQUFNLFVBQVUsU0FBUyxDQUFFLEVBQW1CO0lBQzVDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLFFBQVEsS0FBSyxJQUFJLENBQUMsWUFBWTtRQUFFLE9BQU8sQ0FBQyxDQUFBO0lBRXRELE1BQU0sS0FBSyxHQUFHLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFBO0lBRXRFLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQztRQUFFLE9BQU8sU0FBUyxDQUFDLEVBQUUsQ0FBQyxVQUFxQixDQUFDLENBQUE7SUFDNUQsT0FBTyxLQUFLLENBQUE7QUFDZCxDQUFDO0FBRUQsTUFBTSxhQUFhLEdBQUc7SUFDcEIsR0FBRyxFQUFFLE9BQU87SUFDWixHQUFHLEVBQUUsTUFBTTtJQUNYLEdBQUcsRUFBRSxNQUFNO0NBQ0wsQ0FBQTtBQUVSLE1BQU0sVUFBVSxVQUFVLENBQUUsR0FBVztJQUNyQyxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFBO0FBQ2hFLENBQUM7QUFFRCxNQUFNLFVBQVUsa0JBQWtCLENBQXdCLEdBQU0sRUFBRSxJQUFTO0lBQ3pFLE1BQU0sUUFBUSxHQUFHLEVBQXdCLENBQUE7SUFFekMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDcEMsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ25CLElBQUksT0FBTyxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssV0FBVyxFQUFFO1lBQ25DLFFBQVEsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7U0FDekI7S0FDRjtJQUVELE9BQU8sUUFBUSxDQUFBO0FBQ2pCLENBQUM7QUFFRCxNQUFNLFVBQVUsY0FBYyxDQUFFLFFBQWlCLEVBQUUsRUFBRSxHQUFXO0lBQzlELE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUMxQixPQUFPLEtBQUssQ0FBQyxnQkFBZ0I7WUFDM0IsS0FBSyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLEdBQUcsQ0FBQTtJQUNwRCxDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUM7QUFFRCxNQUFNLFVBQVUsYUFBYSxDQUFFLEdBQXVDLEVBQUUsSUFBSSxHQUFHLElBQUk7SUFDakYsSUFBSSxHQUFHLElBQUksSUFBSSxJQUFJLEdBQUcsS0FBSyxFQUFFLEVBQUU7UUFDN0IsT0FBTyxTQUFTLENBQUE7S0FDakI7U0FBTSxJQUFJLEtBQUssQ0FBQyxDQUFDLEdBQUksQ0FBQyxFQUFFO1FBQ3ZCLE9BQU8sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0tBQ25CO1NBQU07UUFDTCxPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFBO0tBQy9CO0FBQ0gsQ0FBQztBQUVELE1BQU0sVUFBVSxTQUFTLENBQUUsR0FBVztJQUNwQyxPQUFPLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxPQUFPLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtBQUN0RSxDQUFDO0FBRUQsTUFBTSxVQUFVLFFBQVEsQ0FBRSxHQUFRO0lBQ2hDLE9BQU8sR0FBRyxLQUFLLElBQUksSUFBSSxPQUFPLEdBQUcsS0FBSyxRQUFRLENBQUE7QUFDaEQsQ0FBQztBQUVELGdDQUFnQztBQUNoQyxNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNwQyxLQUFLLEVBQUUsRUFBRTtJQUNULEdBQUcsRUFBRSxDQUFDO0lBQ04sTUFBTSxFQUFFLEVBQUU7SUFDVixHQUFHLEVBQUUsRUFBRTtJQUNQLEtBQUssRUFBRSxFQUFFO0lBQ1QsRUFBRSxFQUFFLEVBQUU7SUFDTixJQUFJLEVBQUUsRUFBRTtJQUNSLElBQUksRUFBRSxFQUFFO0lBQ1IsS0FBSyxFQUFFLEVBQUU7SUFDVCxHQUFHLEVBQUUsRUFBRTtJQUNQLElBQUksRUFBRSxFQUFFO0lBQ1IsR0FBRyxFQUFFLEVBQUU7SUFDUCxTQUFTLEVBQUUsQ0FBQztJQUNaLE1BQU0sRUFBRSxFQUFFO0lBQ1YsTUFBTSxFQUFFLEVBQUU7SUFDVixRQUFRLEVBQUUsRUFBRTtDQUNiLENBQUMsQ0FBQTtBQUVGLE1BQU0sWUFBWSxHQUFHLGlCQUFpQixDQUFBO0FBRXRDLDhFQUE4RTtBQUM5RSxpQkFBaUI7QUFDakIsTUFBTSxVQUFVLGlCQUFpQixDQUFFLEVBQU8sRUFBRSxRQUFnQjtJQUMxRCxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsRUFBRTtRQUN0QyxPQUFPLFFBQVEsQ0FBQTtLQUNoQjtJQUVELGtFQUFrRTtJQUNsRSxPQUFPLG9CQUFvQixDQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUE7QUFDckQsQ0FBQztBQUVELE1BQU0sVUFBVSxJQUFJLENBQUssQ0FBSTtJQUMzQixPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFnQixDQUFBO0FBQ3RDLENBQUM7QUFFRDs7R0FFRztBQUNILE1BQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQTtBQUMzQixNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsQ0FBQyxHQUFXLEVBQVUsRUFBRTtJQUM5QyxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFBO0FBQ3BFLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZ1ZSB9IGZyb20gJ3Z1ZS90eXBlcy92dWUnXG5pbXBvcnQgeyBWTm9kZSwgVk5vZGVEaXJlY3RpdmUsIEZ1bmN0aW9uYWxDb21wb25lbnRPcHRpb25zIH0gZnJvbSAndnVlL3R5cGVzJ1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2ltcGxlRnVuY3Rpb25hbCAoXG4gIGM6IHN0cmluZyxcbiAgZWwgPSAnZGl2JyxcbiAgbmFtZT86IHN0cmluZ1xuKTogRnVuY3Rpb25hbENvbXBvbmVudE9wdGlvbnMge1xuICByZXR1cm4ge1xuICAgIG5hbWU6IG5hbWUgfHwgYy5yZXBsYWNlKC9fXy9nLCAnLScpLFxuXG4gICAgZnVuY3Rpb25hbDogdHJ1ZSxcblxuICAgIHJlbmRlciAoaCwgeyBkYXRhLCBjaGlsZHJlbiB9KTogVk5vZGUge1xuICAgICAgZGF0YS5zdGF0aWNDbGFzcyA9IChgJHtjfSAke2RhdGEuc3RhdGljQ2xhc3MgfHwgJyd9YCkudHJpbSgpXG5cbiAgICAgIHJldHVybiBoKGVsLCBkYXRhLCBjaGlsZHJlbilcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gbWVyZ2VUcmFuc2l0aW9ucyAoXG4gIHRyYW5zaXRpb25zOiB1bmRlZmluZWQgfCBGdW5jdGlvbiB8IEZ1bmN0aW9uW10sXG4gIGFycmF5OiBGdW5jdGlvbltdXG4pIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkodHJhbnNpdGlvbnMpKSByZXR1cm4gdHJhbnNpdGlvbnMuY29uY2F0KGFycmF5KVxuICBpZiAodHJhbnNpdGlvbnMpIGFycmF5LnB1c2godHJhbnNpdGlvbnMpXG4gIHJldHVybiBhcnJheVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2ltcGxlVHJhbnNpdGlvbiAoXG4gIG5hbWU6IHN0cmluZyxcbiAgb3JpZ2luID0gJ3RvcCBjZW50ZXIgMCcsXG4gIG1vZGU/OiBzdHJpbmdcbik6IEZ1bmN0aW9uYWxDb21wb25lbnRPcHRpb25zIHtcbiAgcmV0dXJuIHtcbiAgICBuYW1lLFxuXG4gICAgZnVuY3Rpb25hbDogdHJ1ZSxcblxuICAgIHByb3BzOiB7XG4gICAgICBncm91cDoge1xuICAgICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgICBkZWZhdWx0OiBmYWxzZVxuICAgICAgfSxcbiAgICAgIGhpZGVPbkxlYXZlOiB7XG4gICAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICAgIGRlZmF1bHQ6IGZhbHNlXG4gICAgICB9LFxuICAgICAgbGVhdmVBYnNvbHV0ZToge1xuICAgICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgICBkZWZhdWx0OiBmYWxzZVxuICAgICAgfSxcbiAgICAgIG1vZGU6IHtcbiAgICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgICBkZWZhdWx0OiBtb2RlXG4gICAgICB9LFxuICAgICAgb3JpZ2luOiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogb3JpZ2luXG4gICAgICB9XG4gICAgfSxcblxuICAgIHJlbmRlciAoaCwgY29udGV4dCk6IFZOb2RlIHtcbiAgICAgIGNvbnN0IHRhZyA9IGB0cmFuc2l0aW9uJHtjb250ZXh0LnByb3BzLmdyb3VwID8gJy1ncm91cCcgOiAnJ31gXG4gICAgICBjb250ZXh0LmRhdGEgPSBjb250ZXh0LmRhdGEgfHwge31cbiAgICAgIGNvbnRleHQuZGF0YS5wcm9wcyA9IHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbW9kZTogY29udGV4dC5wcm9wcy5tb2RlXG4gICAgICB9XG4gICAgICBjb250ZXh0LmRhdGEub24gPSBjb250ZXh0LmRhdGEub24gfHwge31cbiAgICAgIGlmICghT2JqZWN0LmlzRXh0ZW5zaWJsZShjb250ZXh0LmRhdGEub24pKSB7XG4gICAgICAgIGNvbnRleHQuZGF0YS5vbiA9IHsgLi4uY29udGV4dC5kYXRhLm9uIH1cbiAgICAgIH1cblxuICAgICAgY29uc3Qgb3VyQmVmb3JlRW50ZXI6IEZ1bmN0aW9uW10gPSBbXVxuICAgICAgY29uc3Qgb3VyTGVhdmU6IEZ1bmN0aW9uW10gPSBbXVxuICAgICAgY29uc3QgYWJzb2x1dGUgPSAoZWw6IEhUTUxFbGVtZW50KSA9PiAoZWwuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnKVxuXG4gICAgICBvdXJCZWZvcmVFbnRlci5wdXNoKChlbDogSFRNTEVsZW1lbnQpID0+IHtcbiAgICAgICAgZWwuc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gY29udGV4dC5wcm9wcy5vcmlnaW5cbiAgICAgICAgZWwuc3R5bGUud2Via2l0VHJhbnNmb3JtT3JpZ2luID0gY29udGV4dC5wcm9wcy5vcmlnaW5cbiAgICAgIH0pXG5cbiAgICAgIGlmIChjb250ZXh0LnByb3BzLmxlYXZlQWJzb2x1dGUpIG91ckxlYXZlLnB1c2goYWJzb2x1dGUpXG4gICAgICBpZiAoY29udGV4dC5wcm9wcy5oaWRlT25MZWF2ZSkge1xuICAgICAgICBvdXJMZWF2ZS5wdXNoKChlbDogSFRNTEVsZW1lbnQpID0+IChlbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnKSlcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBiZWZvcmVFbnRlciwgbGVhdmUgfSA9IGNvbnRleHQuZGF0YS5vblxuXG4gICAgICAvLyBUeXBlIHNheXMgRnVuY3Rpb24gfCBGdW5jdGlvbltdIGJ1dFxuICAgICAgLy8gd2lsbCBvbmx5IHdvcmsgaWYgcHJvdmlkZWQgYSBmdW5jdGlvblxuICAgICAgY29udGV4dC5kYXRhLm9uLmJlZm9yZUVudGVyID0gKCkgPT4gbWVyZ2VUcmFuc2l0aW9ucyhiZWZvcmVFbnRlciwgb3VyQmVmb3JlRW50ZXIpXG4gICAgICBjb250ZXh0LmRhdGEub24ubGVhdmUgPSBtZXJnZVRyYW5zaXRpb25zKGxlYXZlLCBvdXJMZWF2ZSlcblxuICAgICAgcmV0dXJuIGgodGFnLCBjb250ZXh0LmRhdGEsIGNvbnRleHQuY2hpbGRyZW4pXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVKYXZhU2NyaXB0VHJhbnNpdGlvbiAoXG4gIG5hbWU6IHN0cmluZyxcbiAgZnVuY3Rpb25zOiBSZWNvcmQ8c3RyaW5nLCAoKSA9PiBhbnk+LFxuICBtb2RlID0gJ2luLW91dCdcbik6IEZ1bmN0aW9uYWxDb21wb25lbnRPcHRpb25zIHtcbiAgcmV0dXJuIHtcbiAgICBuYW1lLFxuXG4gICAgZnVuY3Rpb25hbDogdHJ1ZSxcblxuICAgIHByb3BzOiB7XG4gICAgICBtb2RlOiB7XG4gICAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgICAgZGVmYXVsdDogbW9kZVxuICAgICAgfVxuICAgIH0sXG5cbiAgICByZW5kZXIgKGgsIGNvbnRleHQpOiBWTm9kZSB7XG4gICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICBwcm9wczoge1xuICAgICAgICAgIC4uLmNvbnRleHQucHJvcHMsXG4gICAgICAgICAgbmFtZVxuICAgICAgICB9LFxuICAgICAgICBvbjogZnVuY3Rpb25zXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoKCd0cmFuc2l0aW9uJywgZGF0YSwgY29udGV4dC5jaGlsZHJlbilcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgQmluZGluZ0NvbmZpZyA9IFBpY2s8Vk5vZGVEaXJlY3RpdmUsICdhcmcnIHwgJ21vZGlmaWVycycgfCAndmFsdWUnPlxuZXhwb3J0IGZ1bmN0aW9uIGRpcmVjdGl2ZUNvbmZpZyAoYmluZGluZzogQmluZGluZ0NvbmZpZywgZGVmYXVsdHMgPSB7fSk6IFZOb2RlRGlyZWN0aXZlIHtcbiAgcmV0dXJuIHtcbiAgICAuLi5kZWZhdWx0cyxcbiAgICAuLi5iaW5kaW5nLm1vZGlmaWVycyxcbiAgICB2YWx1ZTogYmluZGluZy5hcmcsXG4gICAgLi4uKGJpbmRpbmcudmFsdWUgfHwge30pXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZE9uY2VFdmVudExpc3RlbmVyIChlbDogRXZlbnRUYXJnZXQsIGV2ZW50OiBzdHJpbmcsIGNiOiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gIHZhciBvbmNlID0gKCkgPT4ge1xuICAgIGNiKClcbiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBvbmNlLCBmYWxzZSlcbiAgfVxuXG4gIGVsLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIG9uY2UsIGZhbHNlKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TmVzdGVkVmFsdWUgKG9iajogYW55LCBwYXRoOiAoc3RyaW5nIHwgbnVtYmVyKVtdLCBmYWxsYmFjaz86IGFueSk6IGFueSB7XG4gIGNvbnN0IGxhc3QgPSBwYXRoLmxlbmd0aCAtIDFcblxuICBpZiAobGFzdCA8IDApIHJldHVybiBvYmogPT09IHVuZGVmaW5lZCA/IGZhbGxiYWNrIDogb2JqXG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsYXN0OyBpKyspIHtcbiAgICBpZiAob2JqID09IG51bGwpIHtcbiAgICAgIHJldHVybiBmYWxsYmFja1xuICAgIH1cbiAgICBvYmogPSBvYmpbcGF0aFtpXV1cbiAgfVxuXG4gIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIGZhbGxiYWNrXG5cbiAgcmV0dXJuIG9ialtwYXRoW2xhc3RdXSA9PT0gdW5kZWZpbmVkID8gZmFsbGJhY2sgOiBvYmpbcGF0aFtsYXN0XV1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlZXBFcXVhbCAoYTogYW55LCBiOiBhbnkpOiBib29sZWFuIHtcbiAgaWYgKGEgPT09IGIpIHJldHVybiB0cnVlXG5cbiAgaWYgKGEgaW5zdGFuY2VvZiBEYXRlICYmIGIgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgLy8gSWYgdGhlIHZhbHVlcyBhcmUgRGF0ZSwgdGhleSB3ZXJlIGNvbnZlcnQgdG8gdGltZXN0YW1wIHdpdGggZ2V0VGltZSBhbmQgY29tcGFyZSBpdFxuICAgIGlmIChhLmdldFRpbWUoKSAhPT0gYi5nZXRUaW1lKCkpIHJldHVybiBmYWxzZVxuICB9XG5cbiAgaWYgKGEgIT09IE9iamVjdChhKSB8fCBiICE9PSBPYmplY3QoYikpIHtcbiAgICAvLyBJZiB0aGUgdmFsdWVzIGFyZW4ndCBvYmplY3RzLCB0aGV5IHdlcmUgYWxyZWFkeSBjaGVja2VkIGZvciBlcXVhbGl0eVxuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgY29uc3QgcHJvcHMgPSBPYmplY3Qua2V5cyhhKVxuXG4gIGlmIChwcm9wcy5sZW5ndGggIT09IE9iamVjdC5rZXlzKGIpLmxlbmd0aCkge1xuICAgIC8vIERpZmZlcmVudCBudW1iZXIgb2YgcHJvcHMsIGRvbid0IGJvdGhlciB0byBjaGVja1xuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgcmV0dXJuIHByb3BzLmV2ZXJ5KHAgPT4gZGVlcEVxdWFsKGFbcF0sIGJbcF0pKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0T2JqZWN0VmFsdWVCeVBhdGggKG9iajogb2JqZWN0LCBwYXRoOiBzdHJpbmcsIGZhbGxiYWNrPzogYW55KTogYW55IHtcbiAgLy8gY3JlZGl0OiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzY0OTE0NjMvYWNjZXNzaW5nLW5lc3RlZC1qYXZhc2NyaXB0LW9iamVjdHMtd2l0aC1zdHJpbmcta2V5I2NvbW1lbnQ1NTI3ODQxM182NDkxNjIxXG4gIGlmICghcGF0aCB8fCBwYXRoLmNvbnN0cnVjdG9yICE9PSBTdHJpbmcpIHJldHVybiBmYWxsYmFja1xuICBwYXRoID0gcGF0aC5yZXBsYWNlKC9cXFsoXFx3KylcXF0vZywgJy4kMScpIC8vIGNvbnZlcnQgaW5kZXhlcyB0byBwcm9wZXJ0aWVzXG4gIHBhdGggPSBwYXRoLnJlcGxhY2UoL15cXC4vLCAnJykgLy8gc3RyaXAgYSBsZWFkaW5nIGRvdFxuICByZXR1cm4gZ2V0TmVzdGVkVmFsdWUob2JqLCBwYXRoLnNwbGl0KCcuJyksIGZhbGxiYWNrKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UHJvcGVydHlGcm9tSXRlbSAoXG4gIGl0ZW06IG9iamVjdCxcbiAgcHJvcGVydHk6IHN0cmluZyB8IChzdHJpbmcgfCBudW1iZXIpW10gfCAoKGl0ZW06IG9iamVjdCwgZmFsbGJhY2s/OiBhbnkpID0+IGFueSksXG4gIGZhbGxiYWNrPzogYW55XG4pOiBhbnkge1xuICBpZiAocHJvcGVydHkgPT0gbnVsbCkgcmV0dXJuIGl0ZW0gPT09IHVuZGVmaW5lZCA/IGZhbGxiYWNrIDogaXRlbVxuXG4gIGlmIChpdGVtICE9PSBPYmplY3QoaXRlbSkpIHJldHVybiBmYWxsYmFjayA9PT0gdW5kZWZpbmVkID8gaXRlbSA6IGZhbGxiYWNrXG5cbiAgaWYgKHR5cGVvZiBwcm9wZXJ0eSA9PT0gJ3N0cmluZycpIHJldHVybiBnZXRPYmplY3RWYWx1ZUJ5UGF0aChpdGVtLCBwcm9wZXJ0eSwgZmFsbGJhY2spXG5cbiAgaWYgKEFycmF5LmlzQXJyYXkocHJvcGVydHkpKSByZXR1cm4gZ2V0TmVzdGVkVmFsdWUoaXRlbSwgcHJvcGVydHksIGZhbGxiYWNrKVxuXG4gIGlmICh0eXBlb2YgcHJvcGVydHkgIT09ICdmdW5jdGlvbicpIHJldHVybiBmYWxsYmFja1xuXG4gIGNvbnN0IHZhbHVlID0gcHJvcGVydHkoaXRlbSwgZmFsbGJhY2spXG5cbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgPyBmYWxsYmFjayA6IHZhbHVlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSYW5nZSAobGVuZ3RoOiBudW1iZXIpOiBudW1iZXJbXSB7XG4gIHJldHVybiBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sICh2LCBrKSA9PiBrKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0WkluZGV4IChlbD86IEVsZW1lbnQgfCBudWxsKTogbnVtYmVyIHtcbiAgaWYgKCFlbCB8fCBlbC5ub2RlVHlwZSAhPT0gTm9kZS5FTEVNRU5UX05PREUpIHJldHVybiAwXG5cbiAgY29uc3QgaW5kZXggPSArd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwpLmdldFByb3BlcnR5VmFsdWUoJ3otaW5kZXgnKVxuXG4gIGlmIChpc05hTihpbmRleCkpIHJldHVybiBnZXRaSW5kZXgoZWwucGFyZW50Tm9kZSBhcyBFbGVtZW50KVxuICByZXR1cm4gaW5kZXhcbn1cblxuY29uc3QgdGFnc1RvUmVwbGFjZSA9IHtcbiAgJyYnOiAnJmFtcDsnLFxuICAnPCc6ICcmbHQ7JyxcbiAgJz4nOiAnJmd0Oydcbn0gYXMgYW55XG5cbmV4cG9ydCBmdW5jdGlvbiBlc2NhcGVIVE1MIChzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvWyY8Pl0vZywgdGFnID0+IHRhZ3NUb1JlcGxhY2VbdGFnXSB8fCB0YWcpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJPYmplY3RPbktleXM8VCwgSyBleHRlbmRzIGtleW9mIFQ+IChvYmo6IFQsIGtleXM6IEtbXSk6IHsgW04gaW4gS106IFRbTl0gfSB7XG4gIGNvbnN0IGZpbHRlcmVkID0ge30gYXMgeyBbTiBpbiBLXTogVFtOXSB9XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3Qga2V5ID0ga2V5c1tpXVxuICAgIGlmICh0eXBlb2Ygb2JqW2tleV0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBmaWx0ZXJlZFtrZXldID0gb2JqW2tleV1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmlsdGVyZWRcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbHRlckNoaWxkcmVuIChhcnJheTogVk5vZGVbXSA9IFtdLCB0YWc6IHN0cmluZyk6IFZOb2RlW10ge1xuICByZXR1cm4gYXJyYXkuZmlsdGVyKGNoaWxkID0+IHtcbiAgICByZXR1cm4gY2hpbGQuY29tcG9uZW50T3B0aW9ucyAmJlxuICAgICAgY2hpbGQuY29tcG9uZW50T3B0aW9ucy5DdG9yLm9wdGlvbnMubmFtZSA9PT0gdGFnXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0VG9Vbml0IChzdHI6IHN0cmluZyB8IG51bWJlciB8IG51bGwgfCB1bmRlZmluZWQsIHVuaXQgPSAncHgnKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgaWYgKHN0ciA9PSBudWxsIHx8IHN0ciA9PT0gJycpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkXG4gIH0gZWxzZSBpZiAoaXNOYU4oK3N0ciEpKSB7XG4gICAgcmV0dXJuIFN0cmluZyhzdHIpXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGAke051bWJlcihzdHIpfSR7dW5pdH1gXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGtlYmFiQ2FzZSAoc3RyOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gKHN0ciB8fCAnJykucmVwbGFjZSgvKFthLXpdKShbQS1aXSkvZywgJyQxLSQyJykudG9Mb3dlckNhc2UoKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNPYmplY3QgKG9iajogYW55KTogb2JqIGlzIG9iamVjdCB7XG4gIHJldHVybiBvYmogIT09IG51bGwgJiYgdHlwZW9mIG9iaiA9PT0gJ29iamVjdCdcbn1cblxuLy8gS2V5Ym9hcmRFdmVudC5rZXlDb2RlIGFsaWFzZXNcbmV4cG9ydCBjb25zdCBrZXlDb2RlcyA9IE9iamVjdC5mcmVlemUoe1xuICBlbnRlcjogMTMsXG4gIHRhYjogOSxcbiAgZGVsZXRlOiA0NixcbiAgZXNjOiAyNyxcbiAgc3BhY2U6IDMyLFxuICB1cDogMzgsXG4gIGRvd246IDQwLFxuICBsZWZ0OiAzNyxcbiAgcmlnaHQ6IDM5LFxuICBlbmQ6IDM1LFxuICBob21lOiAzNixcbiAgZGVsOiA0NixcbiAgYmFja3NwYWNlOiA4LFxuICBpbnNlcnQ6IDQ1LFxuICBwYWdldXA6IDMzLFxuICBwYWdlZG93bjogMzRcbn0pXG5cbmNvbnN0IElDT05TX1BSRUZJWCA9ICckdnVldGlmeS5pY29ucy4nXG5cbi8vIFRoaXMgcmVtYXBzIGludGVybmFsIG5hbWVzIGxpa2UgJyR2dWV0aWZ5Lmljb25zLmNhbmNlbCcgdG8gdGhlIGN1cnJlbnQgbmFtZVxuLy8gZm9yIHRoYXQgaWNvbi5cbmV4cG9ydCBmdW5jdGlvbiByZW1hcEludGVybmFsSWNvbiAodm06IFZ1ZSwgaWNvbk5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIGlmICghaWNvbk5hbWUuc3RhcnRzV2l0aChJQ09OU19QUkVGSVgpKSB7XG4gICAgcmV0dXJuIGljb25OYW1lXG4gIH1cblxuICAvLyBOb3cgbG9vayB1cCBpY29uIGluZGlyZWN0aW9uIG5hbWUsIGUuZy4gJyR2dWV0aWZ5Lmljb25zLmNhbmNlbCdcbiAgcmV0dXJuIGdldE9iamVjdFZhbHVlQnlQYXRoKHZtLCBpY29uTmFtZSwgaWNvbk5hbWUpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBrZXlzPE8+IChvOiBPKSB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhvKSBhcyAoa2V5b2YgTylbXVxufVxuXG4vKipcbiAqIENhbWVsaXplIGEgaHlwaGVuLWRlbGltaXRlZCBzdHJpbmcuXG4gKi9cbmNvbnN0IGNhbWVsaXplUkUgPSAvLShcXHcpL2dcbmV4cG9ydCBjb25zdCBjYW1lbGl6ZSA9IChzdHI6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gIHJldHVybiBzdHIucmVwbGFjZShjYW1lbGl6ZVJFLCAoXywgYykgPT4gYyA/IGMudG9VcHBlckNhc2UoKSA6ICcnKVxufVxuIl19