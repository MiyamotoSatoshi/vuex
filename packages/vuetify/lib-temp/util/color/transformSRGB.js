// For converting XYZ to sRGB
const srgbForwardMatrix = [
    [3.2406, -1.5372, -0.4986],
    [-0.9689, 1.8758, 0.0415],
    [0.0557, -0.2040, 1.0570]
];
// Forward gamma adjust
const srgbForwardTransform = (C) => (C <= 0.0031308
    ? C * 12.92
    : 1.055 * C ** (1 / 2.4) - 0.055);
// For converting sRGB to XYZ
const srgbReverseMatrix = [
    [0.4124, 0.3576, 0.1805],
    [0.2126, 0.7152, 0.0722],
    [0.0193, 0.1192, 0.9505]
];
// Reverse gamma adjust
const srgbReverseTransform = (C) => (C <= 0.04045
    ? C / 12.92
    : ((C + 0.055) / 1.055) ** 2.4);
function clamp(value) {
    return Math.max(0, Math.min(1, value));
}
export function fromXYZ(xyz) {
    const rgb = Array(3);
    const transform = srgbForwardTransform;
    const matrix = srgbForwardMatrix;
    // Matrix transform, then gamma adjustment
    for (let i = 0; i < 3; ++i) {
        rgb[i] = Math.round(clamp(transform(matrix[i][0] * xyz[0] +
            matrix[i][1] * xyz[1] +
            matrix[i][2] * xyz[2])) * 255);
    }
    // Rescale back to [0, 255]
    return (rgb[0] << 16) + (rgb[1] << 8) + (rgb[2] << 0);
}
export function toXYZ(rgb) {
    const xyz = [0, 0, 0];
    const transform = srgbReverseTransform;
    const matrix = srgbReverseMatrix;
    // Rescale from [0, 255] to [0, 1] then adjust sRGB gamma to linear RGB
    const r = transform((rgb >> 16 & 0xff) / 255);
    const g = transform((rgb >> 8 & 0xff) / 255);
    const b = transform((rgb >> 0 & 0xff) / 255);
    // Matrix color space transform
    for (let i = 0; i < 3; ++i) {
        xyz[i] = matrix[i][0] * r + matrix[i][1] * g + matrix[i][2] * b;
    }
    return xyz;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtU1JHQi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlsL2NvbG9yL3RyYW5zZm9ybVNSR0IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsNkJBQTZCO0FBQzdCLE1BQU0saUJBQWlCLEdBQUc7SUFDeEIsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxNQUFNLENBQUM7SUFDMUIsQ0FBQyxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDO0lBQ3pCLENBQUMsTUFBTSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztDQUMxQixDQUFBO0FBRUQsdUJBQXVCO0FBQ3ZCLE1BQU0sb0JBQW9CLEdBQUcsQ0FBQyxDQUFTLEVBQVUsRUFBRSxDQUFDLENBQ2xELENBQUMsSUFBSSxTQUFTO0lBQ1osQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLO0lBQ1gsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUNuQyxDQUFBO0FBRUQsNkJBQTZCO0FBQzdCLE1BQU0saUJBQWlCLEdBQUc7SUFDeEIsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQztJQUN4QixDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDO0lBQ3hCLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUM7Q0FDekIsQ0FBQTtBQUVELHVCQUF1QjtBQUN2QixNQUFNLG9CQUFvQixHQUFHLENBQUMsQ0FBUyxFQUFVLEVBQUUsQ0FBQyxDQUNsRCxDQUFDLElBQUksT0FBTztJQUNWLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSztJQUNYLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxHQUFHLEtBQUssQ0FBQyxJQUFJLEdBQUcsQ0FDakMsQ0FBQTtBQUVELFNBQVMsS0FBSyxDQUFFLEtBQWE7SUFDM0IsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFBO0FBQ3hDLENBQUM7QUFFRCxNQUFNLFVBQVUsT0FBTyxDQUFFLEdBQVE7SUFDL0IsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ3BCLE1BQU0sU0FBUyxHQUFHLG9CQUFvQixDQUFBO0lBQ3RDLE1BQU0sTUFBTSxHQUFHLGlCQUFpQixDQUFBO0lBRWhDLDBDQUEwQztJQUMxQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFO1FBQzFCLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQ2pDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQ3RCLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQTtLQUNWO0lBRUQsMkJBQTJCO0lBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7QUFDdkQsQ0FBQztBQUVELE1BQU0sVUFBVSxLQUFLLENBQUUsR0FBUTtJQUM3QixNQUFNLEdBQUcsR0FBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDMUIsTUFBTSxTQUFTLEdBQUcsb0JBQW9CLENBQUE7SUFDdEMsTUFBTSxNQUFNLEdBQUcsaUJBQWlCLENBQUE7SUFFaEMsdUVBQXVFO0lBQ3ZFLE1BQU0sQ0FBQyxHQUFHLFNBQVMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUE7SUFDN0MsTUFBTSxDQUFDLEdBQUcsU0FBUyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQTtJQUM1QyxNQUFNLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFBO0lBRTVDLCtCQUErQjtJQUMvQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFO1FBQzFCLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQTtLQUNoRTtJQUVELE9BQU8sR0FBRyxDQUFBO0FBQ1osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJHQiwgWFlaIH0gZnJvbSAnc3JjL3V0aWwvY29sb3JVdGlscydcblxuLy8gRm9yIGNvbnZlcnRpbmcgWFlaIHRvIHNSR0JcbmNvbnN0IHNyZ2JGb3J3YXJkTWF0cml4ID0gW1xuICBbMy4yNDA2LCAtMS41MzcyLCAtMC40OTg2XSxcbiAgWy0wLjk2ODksIDEuODc1OCwgMC4wNDE1XSxcbiAgWzAuMDU1NywgLTAuMjA0MCwgMS4wNTcwXVxuXVxuXG4vLyBGb3J3YXJkIGdhbW1hIGFkanVzdFxuY29uc3Qgc3JnYkZvcndhcmRUcmFuc2Zvcm0gPSAoQzogbnVtYmVyKTogbnVtYmVyID0+IChcbiAgQyA8PSAwLjAwMzEzMDhcbiAgICA/IEMgKiAxMi45MlxuICAgIDogMS4wNTUgKiBDICoqICgxIC8gMi40KSAtIDAuMDU1XG4pXG5cbi8vIEZvciBjb252ZXJ0aW5nIHNSR0IgdG8gWFlaXG5jb25zdCBzcmdiUmV2ZXJzZU1hdHJpeCA9IFtcbiAgWzAuNDEyNCwgMC4zNTc2LCAwLjE4MDVdLFxuICBbMC4yMTI2LCAwLjcxNTIsIDAuMDcyMl0sXG4gIFswLjAxOTMsIDAuMTE5MiwgMC45NTA1XVxuXVxuXG4vLyBSZXZlcnNlIGdhbW1hIGFkanVzdFxuY29uc3Qgc3JnYlJldmVyc2VUcmFuc2Zvcm0gPSAoQzogbnVtYmVyKTogbnVtYmVyID0+IChcbiAgQyA8PSAwLjA0MDQ1XG4gICAgPyBDIC8gMTIuOTJcbiAgICA6ICgoQyArIDAuMDU1KSAvIDEuMDU1KSAqKiAyLjRcbilcblxuZnVuY3Rpb24gY2xhbXAgKHZhbHVlOiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgdmFsdWUpKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZnJvbVhZWiAoeHl6OiBYWVopOiBSR0Ige1xuICBjb25zdCByZ2IgPSBBcnJheSgzKVxuICBjb25zdCB0cmFuc2Zvcm0gPSBzcmdiRm9yd2FyZFRyYW5zZm9ybVxuICBjb25zdCBtYXRyaXggPSBzcmdiRm9yd2FyZE1hdHJpeFxuXG4gIC8vIE1hdHJpeCB0cmFuc2Zvcm0sIHRoZW4gZ2FtbWEgYWRqdXN0bWVudFxuICBmb3IgKGxldCBpID0gMDsgaSA8IDM7ICsraSkge1xuICAgIHJnYltpXSA9IE1hdGgucm91bmQoY2xhbXAodHJhbnNmb3JtKFxuICAgICAgbWF0cml4W2ldWzBdICogeHl6WzBdICtcbiAgICAgIG1hdHJpeFtpXVsxXSAqIHh5elsxXSArXG4gICAgICBtYXRyaXhbaV1bMl0gKiB4eXpbMl1cbiAgICApKSAqIDI1NSlcbiAgfVxuXG4gIC8vIFJlc2NhbGUgYmFjayB0byBbMCwgMjU1XVxuICByZXR1cm4gKHJnYlswXSA8PCAxNikgKyAocmdiWzFdIDw8IDgpICsgKHJnYlsyXSA8PCAwKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9YWVogKHJnYjogUkdCKTogWFlaIHtcbiAgY29uc3QgeHl6OiBYWVogPSBbMCwgMCwgMF1cbiAgY29uc3QgdHJhbnNmb3JtID0gc3JnYlJldmVyc2VUcmFuc2Zvcm1cbiAgY29uc3QgbWF0cml4ID0gc3JnYlJldmVyc2VNYXRyaXhcblxuICAvLyBSZXNjYWxlIGZyb20gWzAsIDI1NV0gdG8gWzAsIDFdIHRoZW4gYWRqdXN0IHNSR0IgZ2FtbWEgdG8gbGluZWFyIFJHQlxuICBjb25zdCByID0gdHJhbnNmb3JtKChyZ2IgPj4gMTYgJiAweGZmKSAvIDI1NSlcbiAgY29uc3QgZyA9IHRyYW5zZm9ybSgocmdiID4+IDggJiAweGZmKSAvIDI1NSlcbiAgY29uc3QgYiA9IHRyYW5zZm9ybSgocmdiID4+IDAgJiAweGZmKSAvIDI1NSlcblxuICAvLyBNYXRyaXggY29sb3Igc3BhY2UgdHJhbnNmb3JtXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgMzsgKytpKSB7XG4gICAgeHl6W2ldID0gbWF0cml4W2ldWzBdICogciArIG1hdHJpeFtpXVsxXSAqIGcgKyBtYXRyaXhbaV1bMl0gKiBiXG4gIH1cblxuICByZXR1cm4geHl6XG59XG4iXX0=