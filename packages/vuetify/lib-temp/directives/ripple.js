function transform(el, value) {
    el.style['transform'] = value;
    el.style['webkitTransform'] = value;
}
function opacity(el, value) {
    el.style['opacity'] = value.toString();
}
const calculate = (e, el, value = {}) => {
    const offset = el.getBoundingClientRect();
    const localX = e.clientX - offset.left;
    const localY = e.clientY - offset.top;
    let radius = 0;
    let scale = 0.3;
    if (el._ripple && el._ripple.circle) {
        scale = 0.15;
        radius = el.clientWidth / 2;
        radius = value.center ? radius : radius + Math.sqrt((localX - radius) ** 2 + (localY - radius) ** 2) / 4;
    }
    else {
        radius = Math.sqrt(el.clientWidth ** 2 + el.clientHeight ** 2) / 2;
    }
    const centerX = `${(el.clientWidth - (radius * 2)) / 2}px`;
    const centerY = `${(el.clientHeight - (radius * 2)) / 2}px`;
    const x = value.center ? centerX : `${localX - radius}px`;
    const y = value.center ? centerY : `${localY - radius}px`;
    return { radius, scale, x, y, centerX, centerY };
};
const ripple = {
    /* eslint-disable max-statements */
    show(e, el, value = {}) {
        if (!el._ripple || !el._ripple.enabled) {
            return;
        }
        const container = document.createElement('span');
        const animation = document.createElement('span');
        container.appendChild(animation);
        container.className = 'v-ripple__container';
        if (value.class) {
            container.className += ` ${value.class}`;
        }
        const { radius, scale, x, y, centerX, centerY } = calculate(e, el, value);
        animation.className = 'v-ripple__animation';
        animation.style.width = `${radius * 2}px`;
        animation.style.height = animation.style.width;
        el.appendChild(container);
        const computed = window.getComputedStyle(el);
        if (computed.position === 'static') {
            el.style.position = 'relative';
            el.dataset.previousPosition = 'static';
        }
        animation.classList.add('v-ripple__animation--enter');
        animation.classList.add('v-ripple__animation--visible');
        transform(animation, `translate(${x}, ${y}) scale3d(${scale},${scale},${scale})`);
        opacity(animation, 0);
        animation.dataset.activated = String(performance.now());
        setTimeout(() => {
            animation.classList.remove('v-ripple__animation--enter');
            animation.classList.add('v-ripple__animation--in');
            transform(animation, `translate(${centerX}, ${centerY}) scale3d(1,1,1)`);
            opacity(animation, 0.25);
            setTimeout(() => {
                animation.classList.remove('v-ripple__animation--in');
                animation.classList.add('v-ripple__animation--out');
                opacity(animation, 0);
            }, 300);
        }, 0);
    },
    hide(el) {
        if (!el || !el._ripple || !el._ripple.enabled)
            return;
        const ripples = el.getElementsByClassName('v-ripple__animation');
        if (ripples.length === 0)
            return;
        const animation = ripples[ripples.length - 1];
        if (animation.dataset.isHiding)
            return;
        else
            animation.dataset.isHiding = 'true';
        const diff = performance.now() - Number(animation.dataset.activated);
        const delay = Math.max(200 - diff, 0);
        setTimeout(() => {
            animation.classList.remove('v-ripple__animation--out');
            setTimeout(() => {
                const ripples = el.getElementsByClassName('v-ripple__animation');
                if (ripples.length === 1 && el.dataset.previousPosition) {
                    el.style.position = el.dataset.previousPosition;
                    delete el.dataset.previousPosition;
                }
                animation.parentNode && el.removeChild(animation.parentNode);
            }, 300);
        }, delay);
    }
};
function isRippleEnabled(value) {
    return typeof value === 'undefined' || !!value;
}
function rippleShow(e) {
    const value = {};
    const element = e.currentTarget;
    if (!element)
        return;
    value.center = element._ripple.centered;
    if (element._ripple.class) {
        value.class = element._ripple.class;
    }
    ripple.show(e, element, value);
}
function rippleHide(e) {
    ripple.hide(e.currentTarget);
}
function updateRipple(el, binding, wasEnabled) {
    const enabled = isRippleEnabled(binding.value);
    if (!enabled) {
        ripple.hide(el);
    }
    el._ripple = el._ripple || {};
    el._ripple.enabled = enabled;
    const value = binding.value || {};
    if (value.center) {
        el._ripple.centered = true;
    }
    if (value.class) {
        el._ripple.class = binding.value.class;
    }
    if (value.circle) {
        el._ripple.circle = value.circle;
    }
    if (enabled && !wasEnabled) {
        if ('ontouchstart' in window) {
            el.addEventListener('touchend', rippleHide, false);
            el.addEventListener('touchcancel', rippleHide, false);
        }
        el.addEventListener('mousedown', rippleShow, false);
        el.addEventListener('mouseup', rippleHide, false);
        el.addEventListener('mouseleave', rippleHide, false);
        // Anchor tags can be dragged, causes other hides to fail - #1537
        el.addEventListener('dragstart', rippleHide, false);
    }
    else if (!enabled && wasEnabled) {
        removeListeners(el);
    }
}
function removeListeners(el) {
    el.removeEventListener('mousedown', rippleShow, false);
    el.removeEventListener('touchend', rippleHide, false);
    el.removeEventListener('touchcancel', rippleHide, false);
    el.removeEventListener('mouseup', rippleHide, false);
    el.removeEventListener('mouseleave', rippleHide, false);
    el.removeEventListener('dragstart', rippleHide, false);
}
function directive(el, binding) {
    updateRipple(el, binding, false);
}
function unbind(el) {
    delete el._ripple;
    removeListeners(el);
}
function update(el, binding) {
    if (binding.value === binding.oldValue) {
        return;
    }
    const wasEnabled = isRippleEnabled(binding.oldValue);
    updateRipple(el, binding, wasEnabled);
}
export default {
    bind: directive,
    unbind,
    update
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmlwcGxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2RpcmVjdGl2ZXMvcmlwcGxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLFNBQVMsU0FBUyxDQUFFLEVBQWUsRUFBRSxLQUFhO0lBQ2hELEVBQUUsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLEdBQUcsS0FBSyxDQUFBO0lBQzdCLEVBQUUsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsR0FBRyxLQUFLLENBQUE7QUFDckMsQ0FBQztBQUVELFNBQVMsT0FBTyxDQUFFLEVBQWUsRUFBRSxLQUFhO0lBQzlDLEVBQUUsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFBO0FBQ3hDLENBQUM7QUFRRCxNQUFNLFNBQVMsR0FBRyxDQUFDLENBQWEsRUFBRSxFQUFlLEVBQUUsUUFBdUIsRUFBRSxFQUFFLEVBQUU7SUFDOUUsTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDLHFCQUFxQixFQUFFLENBQUE7SUFDekMsTUFBTSxNQUFNLEdBQUcsQ0FBQyxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFBO0lBQ3RDLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQTtJQUVyQyxJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUE7SUFDZCxJQUFJLEtBQUssR0FBRyxHQUFHLENBQUE7SUFDZixJQUFJLEVBQUUsQ0FBQyxPQUFPLElBQUksRUFBRSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUU7UUFDbkMsS0FBSyxHQUFHLElBQUksQ0FBQTtRQUNaLE1BQU0sR0FBRyxFQUFFLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQTtRQUMzQixNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FB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QUNyRCxFQUFFLENBQUMsbUJBQW1CLENBQUMsYUFBYSxFQUFFLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQTtJQUN4RCxFQUFFLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQTtJQUNwRCxFQUFFLENBQUMsbUJBQW1CLENBQUMsWUFBWSxFQUFFLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQTtJQUN2RCxFQUFFLENBQUMsbUJBQW1CLENBQUMsV0FBVyxFQUFFLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQTtBQUN4RCxDQUFDO0FBRUQsU0FBUyxTQUFTLENBQUUsRUFBZSxFQUFFLE9BQXVCO0lBQzFELFlBQVksQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFBO0FBQ2xDLENBQUM7QUFFRCxTQUFTLE1BQU0sQ0FBRSxFQUFlO0lBQzlCLE9BQU8sRUFBRSxDQUFDLE9BQU8sQ0FBQTtJQUNqQixlQUFlLENBQUMsRUFBRSxDQUFDLENBQUE7QUFDckIsQ0FBQztBQUVELFNBQVMsTUFBTSxDQUFFLEVBQWUsRUFBRSxPQUF1QjtJQUN2RCxJQUFJLE9BQU8sQ0FBQyxLQUFLLEtBQUssT0FBTyxDQUFDLFFBQVEsRUFBRTtRQUN0QyxPQUFNO0tBQ1A7SUFFRCxNQUFNLFVBQVUsR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ3BELFlBQVksQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFBO0FBQ3ZDLENBQUM7QUFFRCxlQUFlO0lBQ2IsSUFBSSxFQUFFLFNBQVM7SUFDZixNQUFNO0lBQ04sTUFBTTtDQUNQLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWTm9kZURpcmVjdGl2ZSB9IGZyb20gJ3Z1ZSdcblxuZnVuY3Rpb24gdHJhbnNmb3JtIChlbDogSFRNTEVsZW1lbnQsIHZhbHVlOiBzdHJpbmcpIHtcbiAgZWwuc3R5bGVbJ3RyYW5zZm9ybSddID0gdmFsdWVcbiAgZWwuc3R5bGVbJ3dlYmtpdFRyYW5zZm9ybSddID0gdmFsdWVcbn1cblxuZnVuY3Rpb24gb3BhY2l0eSAoZWw6IEhUTUxFbGVtZW50LCB2YWx1ZTogbnVtYmVyKSB7XG4gIGVsLnN0eWxlWydvcGFjaXR5J10gPSB2YWx1ZS50b1N0cmluZygpXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmlwcGxlT3B0aW9ucyB7XG4gIGNsYXNzPzogc3RyaW5nXG4gIGNlbnRlcj86IGJvb2xlYW5cbiAgY2lyY2xlPzogYm9vbGVhblxufVxuXG5jb25zdCBjYWxjdWxhdGUgPSAoZTogTW91c2VFdmVudCwgZWw6IEhUTUxFbGVtZW50LCB2YWx1ZTogUmlwcGxlT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IG9mZnNldCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gIGNvbnN0IGxvY2FsWCA9IGUuY2xpZW50WCAtIG9mZnNldC5sZWZ0XG4gIGNvbnN0IGxvY2FsWSA9IGUuY2xpZW50WSAtIG9mZnNldC50b3BcblxuICBsZXQgcmFkaXVzID0gMFxuICBsZXQgc2NhbGUgPSAwLjNcbiAgaWYgKGVsLl9yaXBwbGUgJiYgZWwuX3JpcHBsZS5jaXJjbGUpIHtcbiAgICBzY2FsZSA9IDAuMTVcbiAgICByYWRpdXMgPSBlbC5jbGllbnRXaWR0aCAvIDJcbiAgICByYWRpdXMgPSB2YWx1ZS5jZW50ZXIgPyByYWRpdXMgOiByYWRpdXMgKyBNYXRoLnNxcnQoKGxvY2FsWCAtIHJhZGl1cykqKjIgKyAobG9jYWxZIC0gcmFkaXVzKSoqMikgLyA0XG4gIH0gZWxzZSB7XG4gICAgcmFkaXVzID0gTWF0aC5zcXJ0KGVsLmNsaWVudFdpZHRoKioyICsgZWwuY2xpZW50SGVpZ2h0KioyKSAvIDJcbiAgfVxuXG4gIGNvbnN0IGNlbnRlclggPSBgJHsoZWwuY2xpZW50V2lkdGggLSAocmFkaXVzICogMikpIC8gMn1weGBcbiAgY29uc3QgY2VudGVyWSA9IGAkeyhlbC5jbGllbnRIZWlnaHQgLSAocmFkaXVzICogMikpIC8gMn1weGBcblxuICBjb25zdCB4ID0gdmFsdWUuY2VudGVyID8gY2VudGVyWCA6IGAke2xvY2FsWCAtIHJhZGl1c31weGBcbiAgY29uc3QgeSA9IHZhbHVlLmNlbnRlciA/IGNlbnRlclkgOiBgJHtsb2NhbFkgLSByYWRpdXN9cHhgXG5cbiAgcmV0dXJuIHsgcmFkaXVzLCBzY2FsZSwgeCwgeSwgY2VudGVyWCwgY2VudGVyWSB9XG59XG5cbmNvbnN0IHJpcHBsZSA9IHtcbiAgLyogZXNsaW50LWRpc2FibGUgbWF4LXN0YXRlbWVudHMgKi9cbiAgc2hvdyAoZTogTW91c2VFdmVudCwgZWw6IEhUTUxFbGVtZW50LCB2YWx1ZTogUmlwcGxlT3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCFlbC5fcmlwcGxlIHx8ICFlbC5fcmlwcGxlLmVuYWJsZWQpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKVxuICAgIGNvbnN0IGFuaW1hdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKVxuXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGFuaW1hdGlvbilcbiAgICBjb250YWluZXIuY2xhc3NOYW1lID0gJ3YtcmlwcGxlX19jb250YWluZXInXG5cbiAgICBpZiAodmFsdWUuY2xhc3MpIHtcbiAgICAgIGNvbnRhaW5lci5jbGFzc05hbWUgKz0gYCAke3ZhbHVlLmNsYXNzfWBcbiAgICB9XG5cbiAgICBjb25zdCB7IHJhZGl1cywgc2NhbGUsIHgsIHksIGNlbnRlclgsIGNlbnRlclkgfSA9IGNhbGN1bGF0ZShlLCBlbCwgdmFsdWUpXG5cbiAgICBhbmltYXRpb24uY2xhc3NOYW1lID0gJ3YtcmlwcGxlX19hbmltYXRpb24nXG4gICAgYW5pbWF0aW9uLnN0eWxlLndpZHRoID0gYCR7cmFkaXVzICogMn1weGBcbiAgICBhbmltYXRpb24uc3R5bGUuaGVpZ2h0ID0gYW5pbWF0aW9uLnN0eWxlLndpZHRoXG5cbiAgICBlbC5hcHBlbmRDaGlsZChjb250YWluZXIpXG5cbiAgICBjb25zdCBjb21wdXRlZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKVxuICAgIGlmIChjb21wdXRlZC5wb3NpdGlvbiA9PT0gJ3N0YXRpYycpIHtcbiAgICAgIGVsLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJ1xuICAgICAgZWwuZGF0YXNldC5wcmV2aW91c1Bvc2l0aW9uID0gJ3N0YXRpYydcbiAgICB9XG5cbiAgICBhbmltYXRpb24uY2xhc3NMaXN0LmFkZCgndi1yaXBwbGVfX2FuaW1hdGlvbi0tZW50ZXInKVxuICAgIGFuaW1hdGlvbi5jbGFzc0xpc3QuYWRkKCd2LXJpcHBsZV9fYW5pbWF0aW9uLS12aXNpYmxlJylcbiAgICB0cmFuc2Zvcm0oYW5pbWF0aW9uLCBgdHJhbnNsYXRlKCR7eH0sICR7eX0pIHNjYWxlM2QoJHtzY2FsZX0sJHtzY2FsZX0sJHtzY2FsZX0pYClcbiAgICBvcGFjaXR5KGFuaW1hdGlvbiwgMClcbiAgICBhbmltYXRpb24uZGF0YXNldC5hY3RpdmF0ZWQgPSBTdHJpbmcocGVyZm9ybWFuY2Uubm93KCkpXG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGFuaW1hdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCd2LXJpcHBsZV9fYW5pbWF0aW9uLS1lbnRlcicpXG4gICAgICBhbmltYXRpb24uY2xhc3NMaXN0LmFkZCgndi1yaXBwbGVfX2FuaW1hdGlvbi0taW4nKVxuICAgICAgdHJhbnNmb3JtKGFuaW1hdGlvbiwgYHRyYW5zbGF0ZSgke2NlbnRlclh9LCAke2NlbnRlcll9KSBzY2FsZTNkKDEsMSwxKWApXG4gICAgICBvcGFjaXR5KGFuaW1hdGlvbiwgMC4yNSlcblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGFuaW1hdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCd2LXJpcHBsZV9fYW5pbWF0aW9uLS1pbicpXG4gICAgICAgIGFuaW1hdGlvbi5jbGFzc0xpc3QuYWRkKCd2LXJpcHBsZV9fYW5pbWF0aW9uLS1vdXQnKVxuICAgICAgICBvcGFjaXR5KGFuaW1hdGlvbiwgMClcbiAgICAgIH0sIDMwMClcbiAgICB9LCAwKVxuICB9LFxuXG4gIGhpZGUgKGVsOiBIVE1MRWxlbWVudCB8IG51bGwpIHtcbiAgICBpZiAoIWVsIHx8ICFlbC5fcmlwcGxlIHx8ICFlbC5fcmlwcGxlLmVuYWJsZWQpIHJldHVyblxuXG4gICAgY29uc3QgcmlwcGxlcyA9IGVsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3YtcmlwcGxlX19hbmltYXRpb24nKVxuXG4gICAgaWYgKHJpcHBsZXMubGVuZ3RoID09PSAwKSByZXR1cm5cbiAgICBjb25zdCBhbmltYXRpb24gPSByaXBwbGVzW3JpcHBsZXMubGVuZ3RoIC0gMV1cblxuICAgIGlmIChhbmltYXRpb24uZGF0YXNldC5pc0hpZGluZykgcmV0dXJuXG4gICAgZWxzZSBhbmltYXRpb24uZGF0YXNldC5pc0hpZGluZyA9ICd0cnVlJ1xuXG4gICAgY29uc3QgZGlmZiA9IHBlcmZvcm1hbmNlLm5vdygpIC0gTnVtYmVyKGFuaW1hdGlvbi5kYXRhc2V0LmFjdGl2YXRlZClcbiAgICBjb25zdCBkZWxheSA9IE1hdGgubWF4KDIwMCAtIGRpZmYsIDApXG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGFuaW1hdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCd2LXJpcHBsZV9fYW5pbWF0aW9uLS1vdXQnKVxuXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29uc3QgcmlwcGxlcyA9IGVsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3YtcmlwcGxlX19hbmltYXRpb24nKVxuICAgICAgICBpZiAocmlwcGxlcy5sZW5ndGggPT09IDEgJiYgZWwuZGF0YXNldC5wcmV2aW91c1Bvc2l0aW9uKSB7XG4gICAgICAgICAgZWwuc3R5bGUucG9zaXRpb24gPSBlbC5kYXRhc2V0LnByZXZpb3VzUG9zaXRpb25cbiAgICAgICAgICBkZWxldGUgZWwuZGF0YXNldC5wcmV2aW91c1Bvc2l0aW9uXG4gICAgICAgIH1cblxuICAgICAgICBhbmltYXRpb24ucGFyZW50Tm9kZSAmJiBlbC5yZW1vdmVDaGlsZChhbmltYXRpb24ucGFyZW50Tm9kZSlcbiAgICAgIH0sIDMwMClcbiAgICB9LCBkZWxheSlcbiAgfVxufVxuXG5mdW5jdGlvbiBpc1JpcHBsZUVuYWJsZWQgKHZhbHVlOiBhbnkpOiB2YWx1ZSBpcyB0cnVlIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgISF2YWx1ZVxufVxuXG5mdW5jdGlvbiByaXBwbGVTaG93IChlOiBNb3VzZUV2ZW50KSB7XG4gIGNvbnN0IHZhbHVlOiBSaXBwbGVPcHRpb25zID0ge31cbiAgY29uc3QgZWxlbWVudCA9IGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudFxuICBpZiAoIWVsZW1lbnQpIHJldHVyblxuICB2YWx1ZS5jZW50ZXIgPSBlbGVtZW50Ll9yaXBwbGUhLmNlbnRlcmVkXG4gIGlmIChlbGVtZW50Ll9yaXBwbGUhLmNsYXNzKSB7XG4gICAgdmFsdWUuY2xhc3MgPSBlbGVtZW50Ll9yaXBwbGUhLmNsYXNzXG4gIH1cbiAgcmlwcGxlLnNob3coZSwgZWxlbWVudCwgdmFsdWUpXG59XG5cbmZ1bmN0aW9uIHJpcHBsZUhpZGUgKGU6IEV2ZW50KSB7XG4gIHJpcHBsZS5oaWRlKGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudCB8IG51bGwpXG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVJpcHBsZSAoZWw6IEhUTUxFbGVtZW50LCBiaW5kaW5nOiBWTm9kZURpcmVjdGl2ZSwgd2FzRW5hYmxlZDogYm9vbGVhbikge1xuICBjb25zdCBlbmFibGVkID0gaXNSaXBwbGVFbmFibGVkKGJpbmRpbmcudmFsdWUpXG4gIGlmICghZW5hYmxlZCkge1xuICAgIHJpcHBsZS5oaWRlKGVsKVxuICB9XG4gIGVsLl9yaXBwbGUgPSBlbC5fcmlwcGxlIHx8IHt9XG4gIGVsLl9yaXBwbGUuZW5hYmxlZCA9IGVuYWJsZWRcbiAgY29uc3QgdmFsdWUgPSBiaW5kaW5nLnZhbHVlIHx8IHt9XG4gIGlmICh2YWx1ZS5jZW50ZXIpIHtcbiAgICBlbC5fcmlwcGxlLmNlbnRlcmVkID0gdHJ1ZVxuICB9XG4gIGlmICh2YWx1ZS5jbGFzcykge1xuICAgIGVsLl9yaXBwbGUuY2xhc3MgPSBiaW5kaW5nLnZhbHVlLmNsYXNzXG4gIH1cbiAgaWYgKHZhbHVlLmNpcmNsZSkge1xuICAgIGVsLl9yaXBwbGUuY2lyY2xlID0gdmFsdWUuY2lyY2xlXG4gIH1cbiAgaWYgKGVuYWJsZWQgJiYgIXdhc0VuYWJsZWQpIHtcbiAgICBpZiAoJ29udG91Y2hzdGFydCcgaW4gd2luZG93KSB7XG4gICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHJpcHBsZUhpZGUsIGZhbHNlKVxuICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hjYW5jZWwnLCByaXBwbGVIaWRlLCBmYWxzZSlcbiAgICB9XG5cbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCByaXBwbGVTaG93LCBmYWxzZSlcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgcmlwcGxlSGlkZSwgZmFsc2UpXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIHJpcHBsZUhpZGUsIGZhbHNlKVxuICAgIC8vIEFuY2hvciB0YWdzIGNhbiBiZSBkcmFnZ2VkLCBjYXVzZXMgb3RoZXIgaGlkZXMgdG8gZmFpbCAtICMxNTM3XG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgcmlwcGxlSGlkZSwgZmFsc2UpXG4gIH0gZWxzZSBpZiAoIWVuYWJsZWQgJiYgd2FzRW5hYmxlZCkge1xuICAgIHJlbW92ZUxpc3RlbmVycyhlbClcbiAgfVxufVxuXG5mdW5jdGlvbiByZW1vdmVMaXN0ZW5lcnMgKGVsOiBIVE1MRWxlbWVudCkge1xuICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCByaXBwbGVTaG93LCBmYWxzZSlcbiAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCByaXBwbGVIaWRlLCBmYWxzZSlcbiAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hjYW5jZWwnLCByaXBwbGVIaWRlLCBmYWxzZSlcbiAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHJpcHBsZUhpZGUsIGZhbHNlKVxuICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgcmlwcGxlSGlkZSwgZmFsc2UpXG4gIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIHJpcHBsZUhpZGUsIGZhbHNlKVxufVxuXG5mdW5jdGlvbiBkaXJlY3RpdmUgKGVsOiBIVE1MRWxlbWVudCwgYmluZGluZzogVk5vZGVEaXJlY3RpdmUpIHtcbiAgdXBkYXRlUmlwcGxlKGVsLCBiaW5kaW5nLCBmYWxzZSlcbn1cblxuZnVuY3Rpb24gdW5iaW5kIChlbDogSFRNTEVsZW1lbnQpIHtcbiAgZGVsZXRlIGVsLl9yaXBwbGVcbiAgcmVtb3ZlTGlzdGVuZXJzKGVsKVxufVxuXG5mdW5jdGlvbiB1cGRhdGUgKGVsOiBIVE1MRWxlbWVudCwgYmluZGluZzogVk5vZGVEaXJlY3RpdmUpIHtcbiAgaWYgKGJpbmRpbmcudmFsdWUgPT09IGJpbmRpbmcub2xkVmFsdWUpIHtcbiAgICByZXR1cm5cbiAgfVxuXG4gIGNvbnN0IHdhc0VuYWJsZWQgPSBpc1JpcHBsZUVuYWJsZWQoYmluZGluZy5vbGRWYWx1ZSlcbiAgdXBkYXRlUmlwcGxlKGVsLCBiaW5kaW5nLCB3YXNFbmFibGVkKVxufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGJpbmQ6IGRpcmVjdGl2ZSxcbiAgdW5iaW5kLFxuICB1cGRhdGVcbn1cbiJdfQ==