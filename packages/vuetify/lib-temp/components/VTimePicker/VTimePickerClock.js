import '../../stylus/components/_time-picker-clock.styl';
// Mixins
import Colorable from '../../mixins/colorable';
import Themeable from '../../mixins/themeable';
/* @vue/component */
export default {
    name: 'v-time-picker-clock',
    mixins: [
        Colorable,
        Themeable
    ],
    props: {
        allowedValues: Function,
        double: Boolean,
        format: {
            type: Function,
            default: val => val
        },
        max: {
            type: Number,
            required: true
        },
        min: {
            type: Number,
            required: true
        },
        scrollable: Boolean,
        readonly: Boolean,
        rotate: {
            type: Number,
            default: 0
        },
        step: {
            type: Number,
            default: 1
        },
        value: Number
    },
    data() {
        return {
            inputValue: this.value,
            isDragging: false,
            valueOnMouseDown: null,
            valueOnMouseUp: null
        };
    },
    computed: {
        count() {
            return this.max - this.min + 1;
        },
        degreesPerUnit() {
            return 360 / this.roundCount;
        },
        degrees() {
            return this.degreesPerUnit * Math.PI / 180;
        },
        displayedValue() {
            return this.value == null ? this.min : this.value;
        },
        innerRadius() {
            return 0.62;
        },
        roundCount() {
            return this.double ? (this.count / 2) : this.count;
        }
    },
    watch: {
        value(value) {
            this.inputValue = value;
        }
    },
    methods: {
        wheel(e) {
            e.preventDefault();
            const delta = Math.sign(e.wheelDelta || 1);
            let value = this.displayedValue;
            do {
                value = value + delta;
                value = (value - this.min + this.count) % this.count + this.min;
            } while (!this.isAllowed(value) && value !== this.displayedValue);
            if (value !== this.displayedValue) {
                this.update(value);
            }
        },
        isInner(value) {
            return this.double && (value - this.min >= this.roundCount);
        },
        handScale(value) {
            return this.isInner(value) ? this.innerRadius : 1;
        },
        isAllowed(value) {
            return !this.allowedValues || this.allowedValues(value);
        },
        genValues() {
            const children = [];
            for (let value = this.min; value <= this.max; value = value + this.step) {
                const color = value === this.value && (this.color || 'accent');
                children.push(this.$createElement('span', this.setBackgroundColor(color, {
                    staticClass: 'v-time-picker-clock__item',
                    'class': {
                        'v-time-picker-clock__item--active': value === this.displayedValue,
                        'v-time-picker-clock__item--disabled': !this.isAllowed(value)
                    },
                    style: this.getTransform(value),
                    domProps: { innerHTML: `<span>${this.format(value)}</span>` }
                })));
            }
            return children;
        },
        genHand() {
            const scale = `scaleY(${this.handScale(this.displayedValue)})`;
            const angle = this.rotate + this.degreesPerUnit * (this.displayedValue - this.min);
            const color = (this.value != null) && (this.color || 'accent');
            return this.$createElement('div', this.setBackgroundColor(color, {
                staticClass: 'v-time-picker-clock__hand',
                'class': {
                    'v-time-picker-clock__hand--inner': this.isInner(this.value)
                },
                style: {
                    transform: `rotate(${angle}deg) ${scale}`
                }
            }));
        },
        getTransform(i) {
            const { x, y } = this.getPosition(i);
            return {
                left: `${50 + x * 50}%`,
                top: `${50 + y * 50}%`
            };
        },
        getPosition(value) {
            const rotateRadians = this.rotate * Math.PI / 180;
            return {
                x: Math.sin((value - this.min) * this.degrees + rotateRadians) * this.handScale(value),
                y: -Math.cos((value - this.min) * this.degrees + rotateRadians) * this.handScale(value)
            };
        },
        onMouseDown(e) {
            e.preventDefault();
            this.valueOnMouseDown = null;
            this.valueOnMouseUp = null;
            this.isDragging = true;
            this.onDragMove(e);
        },
        onMouseUp() {
            this.isDragging = false;
            if (this.valueOnMouseUp !== null && this.isAllowed(this.valueOnMouseUp)) {
                this.$emit('change', this.valueOnMouseUp);
            }
        },
        onDragMove(e) {
            e.preventDefault();
            if (!this.isDragging && e.type !== 'click')
                return;
            const { width, top, left } = this.$refs.clock.getBoundingClientRect();
            const { clientX, clientY } = 'touches' in e ? e.touches[0] : e;
            const center = { x: width / 2, y: -width / 2 };
            const coords = { x: clientX - left, y: top - clientY };
            const handAngle = Math.round(this.angle(center, coords) - this.rotate + 360) % 360;
            // (1 + this.innerRadius) / 4 = radius of the circle equally distant from inner and outer circles
            const insideClick = this.double && this.euclidean(center, coords) / width < (1 + this.innerRadius) / 4;
            const value = Math.round(handAngle / this.degreesPerUnit) +
                this.min + (insideClick ? this.roundCount : 0);
            // Necessary to fix edge case when selecting left part of the value(s) at 12 o'clock
            let newValue;
            if (handAngle >= (360 - this.degreesPerUnit / 2)) {
                newValue = insideClick ? this.max - this.roundCount + 1 : this.min;
            }
            else {
                newValue = value;
            }
            if (this.isAllowed(value)) {
                if (this.valueOnMouseDown === null) {
                    this.valueOnMouseDown = newValue;
                }
                this.valueOnMouseUp = newValue;
                this.update(newValue);
            }
        },
        update(value) {
            if (this.inputValue !== value) {
                this.inputValue = value;
                this.$emit('input', value);
            }
        },
        euclidean(p0, p1) {
            const dx = p1.x - p0.x;
            const dy = p1.y - p0.y;
            return Math.sqrt(dx * dx + dy * dy);
        },
        angle(center, p1) {
            const value = 2 * Math.atan2(p1.y - center.y - this.euclidean(center, p1), p1.x - center.x);
            return Math.abs(value * 180 / Math.PI);
        }
    },
    render(h) {
        const data = {
            staticClass: 'v-time-picker-clock',
            class: {
                'v-time-picker-clock--indeterminate': this.value == null,
                ...this.themeClasses
            },
            on: this.readonly ? undefined : {
                mousedown: this.onMouseDown,
                mouseup: this.onMouseUp,
                mouseleave: () => (this.isDragging && this.onMouseUp()),
                touchstart: this.onMouseDown,
                touchend: this.onMouseUp,
                mousemove: this.onDragMove,
                touchmove: this.onDragMove
            },
            ref: 'clock'
        };
        !this.readonly && this.scrollable && (data.on.wheel = this.wheel);
        return h('div', data, [
            h('div', {
                staticClass: 'v-time-picker-clock__inner'
            }, [
                this.genHand(),
                this.genValues()
            ])
        ]);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlRpbWVQaWNrZXJDbG9jay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1ZUaW1lUGlja2VyL1ZUaW1lUGlja2VyQ2xvY2suanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxpREFBaUQsQ0FBQTtBQUV4RCxTQUFTO0FBQ1QsT0FBTyxTQUFTLE1BQU0sd0JBQXdCLENBQUE7QUFDOUMsT0FBTyxTQUFTLE1BQU0sd0JBQXdCLENBQUE7QUFFOUMsb0JBQW9CO0FBQ3BCLGVBQWU7SUFDYixJQUFJLEVBQUUscUJBQXFCO0lBRTNCLE1BQU0sRUFBRTtRQUNOLFNBQVM7UUFDVCxTQUFTO0tBQ1Y7SUFFRCxLQUFLLEVBQUU7UUFDTCxhQUFhLEVBQUUsUUFBUTtRQUN2QixNQUFNLEVBQUUsT0FBTztRQUNmLE1BQU0sRUFBRTtZQUNOLElBQUksRUFBRSxRQUFRO1lBQ2QsT0FBTyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRztTQUNwQjtRQUNELEdBQUcsRUFBRTtZQUNILElBQUksRUFBRSxNQUFNO1lBQ1osUUFBUSxFQUFFLElBQUk7U0FDZjtRQUNELEdBQUcsRUFBRTtZQUNILElBQUksRUFBRSxNQUFNO1lBQ1osUUFBUSxFQUFFLElBQUk7U0FDZjtRQUNELFVBQVUsRUFBRSxPQUFPO1FBQ25CLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLE1BQU0sRUFBRTtZQUNOLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLENBQUM7U0FDWDtRQUNELElBQUksRUFBRTtZQUNKLElBQUksRUFBRSxNQUFNO1lBQ1osT0FBTyxFQUFFLENBQUM7U0FDWDtRQUNELEtBQUssRUFBRSxNQUFNO0tBQ2Q7SUFFRCxJQUFJO1FBQ0YsT0FBTztZQUNMLFVBQVUsRUFBRSxJQUFJLENBQUMsS0FBSztZQUN0QixVQUFVLEVBQUUsS0FBSztZQUNqQixnQkFBZ0IsRUFBRSxJQUFJO1lBQ3RCLGNBQWMsRUFBRSxJQUFJO1NBQ3JC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LEdBQUcsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ3ZELFVBQVUsRUFBRSxJQUFJLENBQUMsV0FBVztnQkFDNUIsUUFBUSxFQUFFLElBQUksQ0FBQyxTQUFTO2dCQUN4QixTQUFTLEVBQUUsSUFBSSxDQUFDLFVBQVU7Z0JBQzFCLFNBQVMsRUFBRSxJQUFJLENBQUMsVUFBVTthQUMzQjtZQUNELEdBQUcsRUFBRSxPQUFPO1NBQ2IsQ0FBQTtRQUVELENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsVUFBVSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBRWpFLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUU7WUFDcEIsQ0FBQyxDQUFDLEtBQUssRUFBRTtnQkFDUCxXQUFXLEVBQUUsNEJBQTRCO2FBQzFDLEVBQUU7Z0JBQ0QsSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDZCxJQUFJLENBQUMsU0FBUyxFQUFFO2FBQ2pCLENBQUM7U0FDSCxDQUFDLENBQUE7SUFDSixDQUFDO0NBQ0YsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnLi4vLi4vc3R5bHVzL2NvbXBvbmVudHMvX3RpbWUtcGlja2VyLWNsb2NrLnN0eWwnXG5cbi8vIE1peGluc1xuaW1wb3J0IENvbG9yYWJsZSBmcm9tICcuLi8uLi9taXhpbnMvY29sb3JhYmxlJ1xuaW1wb3J0IFRoZW1lYWJsZSBmcm9tICcuLi8uLi9taXhpbnMvdGhlbWVhYmxlJ1xuXG4vKiBAdnVlL2NvbXBvbmVudCAqL1xuZXhwb3J0IGRlZmF1bHQge1xuICBuYW1lOiAndi10aW1lLXBpY2tlci1jbG9jaycsXG5cbiAgbWl4aW5zOiBbXG4gICAgQ29sb3JhYmxlLFxuICAgIFRoZW1lYWJsZVxuICBdLFxuXG4gIHByb3BzOiB7XG4gICAgYWxsb3dlZFZhbHVlczogRnVuY3Rpb24sXG4gICAgZG91YmxlOiBCb29sZWFuLFxuICAgIGZvcm1hdDoge1xuICAgICAgdHlwZTogRnVuY3Rpb24sXG4gICAgICBkZWZhdWx0OiB2YWwgPT4gdmFsXG4gICAgfSxcbiAgICBtYXg6IHtcbiAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgfSxcbiAgICBtaW46IHtcbiAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgfSxcbiAgICBzY3JvbGxhYmxlOiBCb29sZWFuLFxuICAgIHJlYWRvbmx5OiBCb29sZWFuLFxuICAgIHJvdGF0ZToge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgZGVmYXVsdDogMFxuICAgIH0sXG4gICAgc3RlcDoge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgZGVmYXVsdDogMVxuICAgIH0sXG4gICAgdmFsdWU6IE51bWJlclxuICB9LFxuXG4gIGRhdGEgKCkge1xuICAgIHJldHVybiB7XG4gICAgICBpbnB1dFZhbHVlOiB0aGlzLnZhbHVlLFxuICAgICAgaXNEcmFnZ2luZzogZmFsc2UsXG4gICAgICB2YWx1ZU9uTW91c2VEb3duOiBudWxsLFxuICAgICAgdmFsdWVPbk1vdXNlVXA6IG51bGxcbiAgICB9XG4gIH0sXG5cbiAgY29tcHV0ZWQ6IHtcbiAgICBjb3VudCAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tYXggLSB0aGlzLm1pbiArIDFcbiAgICB9LFxuICAgIGRlZ3JlZXNQZXJVbml0ICgpIHtcbiAgICAgIHJldHVybiAzNjAgLyB0aGlzLnJvdW5kQ291bnRcbiAgICB9LFxuICAgIGRlZ3JlZXMgKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZGVncmVlc1BlclVuaXQgKiBNYXRoLlBJIC8gMTgwXG4gICAgfSxcbiAgICBkaXNwbGF5ZWRWYWx1ZSAoKSB7XG4gICAgICByZXR1cm4gdGhpcy52YWx1ZSA9PSBudWxsID8gdGhpcy5taW4gOiB0aGlzLnZhbHVlXG4gICAgfSxcbiAgICBpbm5lclJhZGl1cyAoKSB7XG4gICAgICByZXR1cm4gMC42MlxuICAgIH0sXG4gICAgcm91bmRDb3VudCAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5kb3VibGUgPyAodGhpcy5jb3VudCAvIDIpIDogdGhpcy5jb3VudFxuICAgIH1cbiAgfSxcblxuICB3YXRjaDoge1xuICAgIHZhbHVlICh2YWx1ZSkge1xuICAgICAgdGhpcy5pbnB1dFZhbHVlID0gdmFsdWVcbiAgICB9XG4gIH0sXG5cbiAgbWV0aG9kczoge1xuICAgIHdoZWVsIChlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcblxuICAgICAgY29uc3QgZGVsdGEgPSBNYXRoLnNpZ24oZS53aGVlbERlbHRhIHx8IDEpXG4gICAgICBsZXQgdmFsdWUgPSB0aGlzLmRpc3BsYXllZFZhbHVlXG4gICAgICBkbyB7XG4gICAgICAgIHZhbHVlID0gdmFsdWUgKyBkZWx0YVxuICAgICAgICB2YWx1ZSA9ICh2YWx1ZSAtIHRoaXMubWluICsgdGhpcy5jb3VudCkgJSB0aGlzLmNvdW50ICsgdGhpcy5taW5cbiAgICAgIH0gd2hpbGUgKCF0aGlzLmlzQWxsb3dlZCh2YWx1ZSkgJiYgdmFsdWUgIT09IHRoaXMuZGlzcGxheWVkVmFsdWUpXG5cbiAgICAgIGlmICh2YWx1ZSAhPT0gdGhpcy5kaXNwbGF5ZWRWYWx1ZSkge1xuICAgICAgICB0aGlzLnVwZGF0ZSh2YWx1ZSlcbiAgICAgIH1cbiAgICB9LFxuICAgIGlzSW5uZXIgKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdGhpcy5kb3VibGUgJiYgKHZhbHVlIC0gdGhpcy5taW4gPj0gdGhpcy5yb3VuZENvdW50KVxuICAgIH0sXG4gICAgaGFuZFNjYWxlICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuaXNJbm5lcih2YWx1ZSkgPyB0aGlzLmlubmVyUmFkaXVzIDogMVxuICAgIH0sXG4gICAgaXNBbGxvd2VkICh2YWx1ZSkge1xuICAgICAgcmV0dXJuICF0aGlzLmFsbG93ZWRWYWx1ZXMgfHwgdGhpcy5hbGxvd2VkVmFsdWVzKHZhbHVlKVxuICAgIH0sXG4gICAgZ2VuVmFsdWVzICgpIHtcbiAgICAgIGNvbnN0IGNoaWxkcmVuID0gW11cblxuICAgICAgZm9yIChsZXQgdmFsdWUgPSB0aGlzLm1pbjsgdmFsdWUgPD0gdGhpcy5tYXg7IHZhbHVlID0gdmFsdWUgKyB0aGlzLnN0ZXApIHtcbiAgICAgICAgY29uc3QgY29sb3IgPSB2YWx1ZSA9PT0gdGhpcy52YWx1ZSAmJiAodGhpcy5jb2xvciB8fCAnYWNjZW50JylcbiAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLiRjcmVhdGVFbGVtZW50KCdzcGFuJywgdGhpcy5zZXRCYWNrZ3JvdW5kQ29sb3IoY29sb3IsIHtcbiAgICAgICAgICBzdGF0aWNDbGFzczogJ3YtdGltZS1waWNrZXItY2xvY2tfX2l0ZW0nLFxuICAgICAgICAgICdjbGFzcyc6IHtcbiAgICAgICAgICAgICd2LXRpbWUtcGlja2VyLWNsb2NrX19pdGVtLS1hY3RpdmUnOiB2YWx1ZSA9PT0gdGhpcy5kaXNwbGF5ZWRWYWx1ZSxcbiAgICAgICAgICAgICd2LXRpbWUtcGlja2VyLWNsb2NrX19pdGVtLS1kaXNhYmxlZCc6ICF0aGlzLmlzQWxsb3dlZCh2YWx1ZSlcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN0eWxlOiB0aGlzLmdldFRyYW5zZm9ybSh2YWx1ZSksXG4gICAgICAgICAgZG9tUHJvcHM6IHsgaW5uZXJIVE1MOiBgPHNwYW4+JHt0aGlzLmZvcm1hdCh2YWx1ZSl9PC9zcGFuPmAgfVxuICAgICAgICB9KSkpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjaGlsZHJlblxuICAgIH0sXG4gICAgZ2VuSGFuZCAoKSB7XG4gICAgICBjb25zdCBzY2FsZSA9IGBzY2FsZVkoJHt0aGlzLmhhbmRTY2FsZSh0aGlzLmRpc3BsYXllZFZhbHVlKX0pYFxuICAgICAgY29uc3QgYW5nbGUgPSB0aGlzLnJvdGF0ZSArIHRoaXMuZGVncmVlc1BlclVuaXQgKiAodGhpcy5kaXNwbGF5ZWRWYWx1ZSAtIHRoaXMubWluKVxuICAgICAgY29uc3QgY29sb3IgPSAodGhpcy52YWx1ZSAhPSBudWxsKSAmJiAodGhpcy5jb2xvciB8fCAnYWNjZW50JylcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCdkaXYnLCB0aGlzLnNldEJhY2tncm91bmRDb2xvcihjb2xvciwge1xuICAgICAgICBzdGF0aWNDbGFzczogJ3YtdGltZS1waWNrZXItY2xvY2tfX2hhbmQnLFxuICAgICAgICAnY2xhc3MnOiB7XG4gICAgICAgICAgJ3YtdGltZS1waWNrZXItY2xvY2tfX2hhbmQtLWlubmVyJzogdGhpcy5pc0lubmVyKHRoaXMudmFsdWUpXG4gICAgICAgIH0sXG4gICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgdHJhbnNmb3JtOiBgcm90YXRlKCR7YW5nbGV9ZGVnKSAke3NjYWxlfWBcbiAgICAgICAgfVxuICAgICAgfSkpXG4gICAgfSxcbiAgICBnZXRUcmFuc2Zvcm0gKGkpIHtcbiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gdGhpcy5nZXRQb3NpdGlvbihpKVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbGVmdDogYCR7NTAgKyB4ICogNTB9JWAsXG4gICAgICAgIHRvcDogYCR7NTAgKyB5ICogNTB9JWBcbiAgICAgIH1cbiAgICB9LFxuICAgIGdldFBvc2l0aW9uICh2YWx1ZSkge1xuICAgICAgY29uc3Qgcm90YXRlUmFkaWFucyA9IHRoaXMucm90YXRlICogTWF0aC5QSSAvIDE4MFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeDogTWF0aC5zaW4oKHZhbHVlIC0gdGhpcy5taW4pICogdGhpcy5kZWdyZWVzICsgcm90YXRlUmFkaWFucykgKiB0aGlzLmhhbmRTY2FsZSh2YWx1ZSksXG4gICAgICAgIHk6IC1NYXRoLmNvcygodmFsdWUgLSB0aGlzLm1pbikgKiB0aGlzLmRlZ3JlZXMgKyByb3RhdGVSYWRpYW5zKSAqIHRoaXMuaGFuZFNjYWxlKHZhbHVlKVxuICAgICAgfVxuICAgIH0sXG4gICAgb25Nb3VzZURvd24gKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgICB0aGlzLnZhbHVlT25Nb3VzZURvd24gPSBudWxsXG4gICAgICB0aGlzLnZhbHVlT25Nb3VzZVVwID0gbnVsbFxuICAgICAgdGhpcy5pc0RyYWdnaW5nID0gdHJ1ZVxuICAgICAgdGhpcy5vbkRyYWdNb3ZlKGUpXG4gICAgfSxcbiAgICBvbk1vdXNlVXAgKCkge1xuICAgICAgdGhpcy5pc0RyYWdnaW5nID0gZmFsc2VcbiAgICAgIGlmICh0aGlzLnZhbHVlT25Nb3VzZVVwICE9PSBudWxsICYmIHRoaXMuaXNBbGxvd2VkKHRoaXMudmFsdWVPbk1vdXNlVXApKSB7XG4gICAgICAgIHRoaXMuJGVtaXQoJ2NoYW5nZScsIHRoaXMudmFsdWVPbk1vdXNlVXApXG4gICAgICB9XG4gICAgfSxcbiAgICBvbkRyYWdNb3ZlIChlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgIGlmICghdGhpcy5pc0RyYWdnaW5nICYmIGUudHlwZSAhPT0gJ2NsaWNrJykgcmV0dXJuXG5cbiAgICAgIGNvbnN0IHsgd2lkdGgsIHRvcCwgbGVmdCB9ID0gdGhpcy4kcmVmcy5jbG9jay5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgICAgY29uc3QgeyBjbGllbnRYLCBjbGllbnRZIH0gPSAndG91Y2hlcycgaW4gZSA/IGUudG91Y2hlc1swXSA6IGVcbiAgICAgIGNvbnN0IGNlbnRlciA9IHsgeDogd2lkdGggLyAyLCB5OiAtd2lkdGggLyAyIH1cbiAgICAgIGNvbnN0IGNvb3JkcyA9IHsgeDogY2xpZW50WCAtIGxlZnQsIHk6IHRvcCAtIGNsaWVudFkgfVxuICAgICAgY29uc3QgaGFuZEFuZ2xlID0gTWF0aC5yb3VuZCh0aGlzLmFuZ2xlKGNlbnRlciwgY29vcmRzKSAtIHRoaXMucm90YXRlICsgMzYwKSAlIDM2MFxuICAgICAgLy8gKDEgKyB0aGlzLmlubmVyUmFkaXVzKSAvIDQgPSByYWRpdXMgb2YgdGhlIGNpcmNsZSBlcXVhbGx5IGRpc3RhbnQgZnJvbSBpbm5lciBhbmQgb3V0ZXIgY2lyY2xlc1xuICAgICAgY29uc3QgaW5zaWRlQ2xpY2sgPSB0aGlzLmRvdWJsZSAmJiB0aGlzLmV1Y2xpZGVhbihjZW50ZXIsIGNvb3JkcykgLyB3aWR0aCA8ICgxICsgdGhpcy5pbm5lclJhZGl1cykgLyA0XG4gICAgICBjb25zdCB2YWx1ZSA9IE1hdGgucm91bmQoaGFuZEFuZ2xlIC8gdGhpcy5kZWdyZWVzUGVyVW5pdCkgK1xuICAgICAgICB0aGlzLm1pbiArIChpbnNpZGVDbGljayA/IHRoaXMucm91bmRDb3VudCA6IDApXG5cbiAgICAgIC8vIE5lY2Vzc2FyeSB0byBmaXggZWRnZSBjYXNlIHdoZW4gc2VsZWN0aW5nIGxlZnQgcGFydCBvZiB0aGUgdmFsdWUocykgYXQgMTIgbydjbG9ja1xuICAgICAgbGV0IG5ld1ZhbHVlXG4gICAgICBpZiAoaGFuZEFuZ2xlID49ICgzNjAgLSB0aGlzLmRlZ3JlZXNQZXJVbml0IC8gMikpIHtcbiAgICAgICAgbmV3VmFsdWUgPSBpbnNpZGVDbGljayA/IHRoaXMubWF4IC0gdGhpcy5yb3VuZENvdW50ICsgMSA6IHRoaXMubWluXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdWYWx1ZSA9IHZhbHVlXG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmlzQWxsb3dlZCh2YWx1ZSkpIHtcbiAgICAgICAgaWYgKHRoaXMudmFsdWVPbk1vdXNlRG93biA9PT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMudmFsdWVPbk1vdXNlRG93biA9IG5ld1ZhbHVlXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy52YWx1ZU9uTW91c2VVcCA9IG5ld1ZhbHVlXG4gICAgICAgIHRoaXMudXBkYXRlKG5ld1ZhbHVlKVxuICAgICAgfVxuICAgIH0sXG4gICAgdXBkYXRlICh2YWx1ZSkge1xuICAgICAgaWYgKHRoaXMuaW5wdXRWYWx1ZSAhPT0gdmFsdWUpIHtcbiAgICAgICAgdGhpcy5pbnB1dFZhbHVlID0gdmFsdWVcbiAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB2YWx1ZSlcbiAgICAgIH1cbiAgICB9LFxuICAgIGV1Y2xpZGVhbiAocDAsIHAxKSB7XG4gICAgICBjb25zdCBkeCA9IHAxLnggLSBwMC54XG4gICAgICBjb25zdCBkeSA9IHAxLnkgLSBwMC55XG5cbiAgICAgIHJldHVybiBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpXG4gICAgfSxcbiAgICBhbmdsZSAoY2VudGVyLCBwMSkge1xuICAgICAgY29uc3QgdmFsdWUgPSAyICogTWF0aC5hdGFuMihwMS55IC0gY2VudGVyLnkgLSB0aGlzLmV1Y2xpZGVhbihjZW50ZXIsIHAxKSwgcDEueCAtIGNlbnRlci54KVxuICAgICAgcmV0dXJuIE1hdGguYWJzKHZhbHVlICogMTgwIC8gTWF0aC5QSSlcbiAgICB9XG4gIH0sXG5cbiAgcmVuZGVyIChoKSB7XG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgIHN0YXRpY0NsYXNzOiAndi10aW1lLXBpY2tlci1jbG9jaycsXG4gICAgICBjbGFzczoge1xuICAgICAgICAndi10aW1lLXBpY2tlci1jbG9jay0taW5kZXRlcm1pbmF0ZSc6IHRoaXMudmFsdWUgPT0gbnVsbCxcbiAgICAgICAgLi4udGhpcy50aGVtZUNsYXNzZXNcbiAgICAgIH0sXG4gICAgICBvbjogdGhpcy5yZWFkb25seSA/IHVuZGVmaW5lZCA6IHtcbiAgICAgICAgbW91c2Vkb3duOiB0aGlzLm9uTW91c2VEb3duLFxuICAgICAgICBtb3VzZXVwOiB0aGlzLm9uTW91c2VVcCxcbiAgICAgICAgbW91c2VsZWF2ZTogKCkgPT4gKHRoaXMuaXNEcmFnZ2luZyAmJiB0aGlzLm9uTW91c2VVcCgpKSxcbiAgICAgICAgdG91Y2hzdGFydDogdGhpcy5vbk1vdXNlRG93bixcbiAgICAgICAgdG91Y2hlbmQ6IHRoaXMub25Nb3VzZVVwLFxuICAgICAgICBtb3VzZW1vdmU6IHRoaXMub25EcmFnTW92ZSxcbiAgICAgICAgdG91Y2htb3ZlOiB0aGlzLm9uRHJhZ01vdmVcbiAgICAgIH0sXG4gICAgICByZWY6ICdjbG9jaydcbiAgICB9XG5cbiAgICAhdGhpcy5yZWFkb25seSAmJiB0aGlzLnNjcm9sbGFibGUgJiYgKGRhdGEub24ud2hlZWwgPSB0aGlzLndoZWVsKVxuXG4gICAgcmV0dXJuIGgoJ2RpdicsIGRhdGEsIFtcbiAgICAgIGgoJ2RpdicsIHtcbiAgICAgICAgc3RhdGljQ2xhc3M6ICd2LXRpbWUtcGlja2VyLWNsb2NrX19pbm5lcidcbiAgICAgIH0sIFtcbiAgICAgICAgdGhpcy5nZW5IYW5kKCksXG4gICAgICAgIHRoaXMuZ2VuVmFsdWVzKClcbiAgICAgIF0pXG4gICAgXSlcbiAgfVxufVxuIl19