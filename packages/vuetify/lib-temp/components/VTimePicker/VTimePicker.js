// Components
import VTimePickerTitle from './VTimePickerTitle';
import VTimePickerClock from './VTimePickerClock';
// Mixins
import Picker from '../../mixins/picker';
// Utils
import { createRange } from '../../util/helpers';
import pad from '../VDatePicker/util/pad';
const rangeHours24 = createRange(24);
const rangeHours12am = createRange(12);
const rangeHours12pm = rangeHours12am.map(v => v + 12);
const rangeMinutes = createRange(60);
/* @vue/component */
export default {
    name: 'v-time-picker',
    mixins: [Picker],
    props: {
        allowedHours: Function,
        allowedMinutes: Function,
        format: {
            type: String,
            default: 'ampm',
            validator(val) {
                return ['ampm', '24hr'].includes(val);
            }
        },
        min: String,
        max: String,
        readonly: Boolean,
        scrollable: Boolean,
        value: null
    },
    data() {
        return {
            inputHour: null,
            inputMinute: null,
            period: 'am',
            selectingHour: true
        };
    },
    computed: {
        isAllowedHourCb() {
            if (!this.min && !this.max)
                return this.allowedHours;
            const minHour = this.min ? this.min.split(':')[0] : 0;
            const maxHour = this.max ? this.max.split(':')[0] : 23;
            return val => {
                return val >= minHour * 1 &&
                    val <= maxHour * 1 &&
                    (!this.allowedHours || this.allowedHours(val));
            };
        },
        isAllowedMinuteCb() {
            const isHourAllowed = !this.allowedHours || this.allowedHours(this.inputHour);
            if (!this.min && !this.max) {
                return isHourAllowed ? this.allowedMinutes : () => false;
            }
            const [minHour, minMinute] = this.min ? this.min.split(':') : [0, 0];
            const [maxHour, maxMinute] = this.max ? this.max.split(':') : [23, 59];
            const minTime = minHour * 60 + minMinute * 1;
            const maxTime = maxHour * 60 + maxMinute * 1;
            return val => {
                const time = 60 * this.inputHour + val;
                return time >= minTime &&
                    time <= maxTime &&
                    isHourAllowed &&
                    (!this.allowedMinutes || this.allowedMinutes(val));
            };
        },
        isAmPm() {
            return this.format === 'ampm';
        }
    },
    watch: {
        value: 'setInputData'
    },
    mounted() {
        this.setInputData(this.value);
    },
    methods: {
        emitValue() {
            if (this.inputHour != null && this.inputMinute != null) {
                this.$emit('input', `${pad(this.inputHour)}:${pad(this.inputMinute)}`);
            }
        },
        setPeriod(period) {
            this.period = period;
            if (this.inputHour != null) {
                const newHour = this.inputHour + (period === 'am' ? -12 : 12);
                this.inputHour = this.firstAllowed('hour', newHour);
                this.emitValue();
            }
        },
        setInputData(value) {
            if (value == null || value === '') {
                this.inputHour = null;
                this.inputMinute = null;
                return;
            }
            if (value instanceof Date) {
                this.inputHour = value.getHours();
                this.inputMinute = value.getMinutes();
            }
            else {
                const [, hour, minute, , period] = value.trim().toLowerCase().match(/^(\d+):(\d+)(:\d+)?([ap]m)?$/, '') || [];
                this.inputHour = period ? this.convert12to24(parseInt(hour, 10), period) : parseInt(hour, 10);
                this.inputMinute = parseInt(minute, 10);
            }
            this.period = this.inputHour < 12 ? 'am' : 'pm';
        },
        convert24to12(hour) {
            return hour ? ((hour - 1) % 12 + 1) : 12;
        },
        convert12to24(hour, period) {
            return hour % 12 + (period === 'pm' ? 12 : 0);
        },
        onInput(value) {
            if (this.selectingHour) {
                this.inputHour = this.isAmPm ? this.convert12to24(value, this.period) : value;
            }
            else {
                this.inputMinute = value;
            }
            this.emitValue();
        },
        onChange() {
            if (!this.selectingHour) {
                this.$emit('change', this.value);
            }
            else {
                this.selectingHour = false;
            }
        },
        firstAllowed(type, value) {
            const allowedFn = type === 'hour' ? this.isAllowedHourCb : this.isAllowedMinuteCb;
            if (!allowedFn)
                return value;
            // TODO: clean up
            const range = type === 'minute'
                ? rangeMinutes
                : (this.isAmPm
                    ? (value < 12
                        ? rangeHours12am
                        : rangeHours12pm)
                    : rangeHours24);
            const first = range.find(v => allowedFn((v + value) % range.length + range[0]));
            return ((first || 0) + value) % range.length + range[0];
        },
        genClock() {
            return this.$createElement(VTimePickerClock, {
                props: {
                    allowedValues: this.selectingHour ? this.isAllowedHourCb : this.isAllowedMinuteCb,
                    color: this.color,
                    dark: this.dark,
                    double: this.selectingHour && !this.isAmPm,
                    format: this.selectingHour ? (this.isAmPm ? this.convert24to12 : val => val) : val => pad(val, 2),
                    light: this.light,
                    max: this.selectingHour ? (this.isAmPm && this.period === 'am' ? 11 : 23) : 59,
                    min: this.selectingHour && this.isAmPm && this.period === 'pm' ? 12 : 0,
                    readonly: this.readonly,
                    scrollable: this.scrollable,
                    size: this.width - ((!this.fullWidth && this.landscape) ? 80 : 20),
                    step: this.selectingHour ? 1 : 5,
                    value: this.selectingHour ? this.inputHour : this.inputMinute
                },
                on: {
                    input: this.onInput,
                    change: this.onChange
                },
                ref: 'clock'
            });
        },
        genPickerBody() {
            return this.$createElement('div', {
                staticClass: 'v-time-picker-clock__container',
                key: this.selectingHour
            }, [this.genClock()]);
        },
        genPickerTitle() {
            return this.$createElement(VTimePickerTitle, {
                props: {
                    ampm: this.isAmPm,
                    hour: this.inputHour,
                    minute: this.inputMinute,
                    period: this.period,
                    readonly: this.readonly,
                    selectingHour: this.selectingHour
                },
                on: {
                    'update:selectingHour': value => (this.selectingHour = value),
                    'update:period': this.setPeriod
                },
                ref: 'title',
                slot: 'title'
            });
        }
    },
    render() {
        return this.genPicker('v-picker--time');
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlRpbWVQaWNrZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WVGltZVBpY2tlci9WVGltZVBpY2tlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxhQUFhO0FBQ2IsT0FBTyxnQkFBZ0IsTUFBTSxvQkFBb0IsQ0FBQTtBQUNqRCxPQUFPLGdCQUFnQixNQUFNLG9CQUFvQixDQUFBO0FBRWpELFNBQVM7QUFDVCxPQUFPLE1BQU0sTUFBTSxxQkFBcUIsQ0FBQTtBQUV4QyxRQUFRO0FBQ1IsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBQ2hELE9BQU8sR0FBRyxNQUFNLHlCQUF5QixDQUFBO0FBRXpDLE1BQU0sWUFBWSxHQUFHLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUNwQyxNQUFNLGNBQWMsR0FBRyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUE7QUFDdEMsTUFBTSxjQUFjLEdBQUcsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQTtBQUN0RCxNQUFNLFlBQVksR0FBRyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUE7QUFFcEMsb0JBQW9CO0FBQ3BCLGVBQWU7SUFDYixJQUFJLEVBQUUsZUFBZTtJQUVyQixNQUFNLEVBQUUsQ0FBQyxNQUFNLENBQUM7SUFFaEIsS0FBSyxFQUFFO1FBQ0wsWUFBWSxFQUFFLFFBQVE7UUFDdEIsY0FBYyxFQUFFLFFBQVE7UUFDeEIsTUFBTSxFQUFFO1lBQ04sSUFBSSxFQUFFLE1BQU07WUFDWixPQUFPLEVBQUUsTUFBTTtZQUNmLFNBQVMsQ0FBRSxHQUFHO2dCQUNaLE9BQU8sQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ3ZDLENBQUM7U0FDRjtRQUNELEdBQUcsRUFBRSxNQUFNO1FBQ1gsR0FBRyxFQUFFLE1B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RSxJQUFJLENBQUMsTUFBTTtvQkFDbkIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO29CQUN2QixhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7aUJBQ2xDO2dCQUNELEVBQUUsRUFBRTtvQkFDRixzQkFBc0IsRUFBRSxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7b0JBQzdELGVBQWUsRUFBRSxJQUFJLENBQUMsU0FBUztpQkFDaEM7Z0JBQ0QsR0FBRyxFQUFFLE9BQU87Z0JBQ1osSUFBSSxFQUFFLE9BQU87YUFDZCxDQUFDLENBQUE7UUFDSixDQUFDO0tBQ0Y7SUFFRCxNQUFNO1FBQ0osT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFnQixDQUFDLENBQUE7SUFDekMsQ0FBQztDQUNGLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb21wb25lbnRzXG5pbXBvcnQgVlRpbWVQaWNrZXJUaXRsZSBmcm9tICcuL1ZUaW1lUGlja2VyVGl0bGUnXG5pbXBvcnQgVlRpbWVQaWNrZXJDbG9jayBmcm9tICcuL1ZUaW1lUGlja2VyQ2xvY2snXG5cbi8vIE1peGluc1xuaW1wb3J0IFBpY2tlciBmcm9tICcuLi8uLi9taXhpbnMvcGlja2VyJ1xuXG4vLyBVdGlsc1xuaW1wb3J0IHsgY3JlYXRlUmFuZ2UgfSBmcm9tICcuLi8uLi91dGlsL2hlbHBlcnMnXG5pbXBvcnQgcGFkIGZyb20gJy4uL1ZEYXRlUGlja2VyL3V0aWwvcGFkJ1xuXG5jb25zdCByYW5nZUhvdXJzMjQgPSBjcmVhdGVSYW5nZSgyNClcbmNvbnN0IHJhbmdlSG91cnMxMmFtID0gY3JlYXRlUmFuZ2UoMTIpXG5jb25zdCByYW5nZUhvdXJzMTJwbSA9IHJhbmdlSG91cnMxMmFtLm1hcCh2ID0+IHYgKyAxMilcbmNvbnN0IHJhbmdlTWludXRlcyA9IGNyZWF0ZVJhbmdlKDYwKVxuXG4vKiBAdnVlL2NvbXBvbmVudCAqL1xuZXhwb3J0IGRlZmF1bHQge1xuICBuYW1lOiAndi10aW1lLXBpY2tlcicsXG5cbiAgbWl4aW5zOiBbUGlja2VyXSxcblxuICBwcm9wczoge1xuICAgIGFsbG93ZWRIb3VyczogRnVuY3Rpb24sXG4gICAgYWxsb3dlZE1pbnV0ZXM6IEZ1bmN0aW9uLFxuICAgIGZvcm1hdDoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogJ2FtcG0nLFxuICAgICAgdmFsaWRhdG9yICh2YWwpIHtcbiAgICAgICAgcmV0dXJuIFsnYW1wbScsICcyNGhyJ10uaW5jbHVkZXModmFsKVxuICAgICAgfVxuICAgIH0sXG4gICAgbWluOiBTdHJpbmcsXG4gICAgbWF4OiBTdHJpbmcsXG4gICAgcmVhZG9ubHk6IEJvb2xlYW4sXG4gICAgc2Nyb2xsYWJsZTogQm9vbGVhbixcbiAgICB2YWx1ZTogbnVsbFxuICB9LFxuXG4gIGRhdGEgKCkge1xuICAgIHJldHVybiB7XG4gICAgICBpbnB1dEhvdXI6IG51bGwsXG4gICAgICBpbnB1dE1pbnV0ZTogbnVsbCxcbiAgICAgIHBlcmlvZDogJ2FtJyxcbiAgICAgIHNlbGVjdGluZ0hvdXI6IHRydWVcbiAgICB9XG4gIH0sXG5cbiAgY29tcHV0ZWQ6IHtcbiAgICBpc0FsbG93ZWRIb3VyQ2IgKCkge1xuICAgICAgaWYgKCF0aGlzLm1pbiAmJiAhdGhpcy5tYXgpIHJldHVybiB0aGlzLmFsbG93ZWRIb3Vyc1xuXG4gICAgICBjb25zdCBtaW5Ib3VyID0gdGhpcy5taW4gPyB0aGlzLm1pbi5zcGxpdCgnOicpWzBdIDogMFxuICAgICAgY29uc3QgbWF4SG91ciA9IHRoaXMubWF4ID8gdGhpcy5tYXguc3BsaXQoJzonKVswXSA6IDIzXG5cbiAgICAgIHJldHVybiB2YWwgPT4ge1xuICAgICAgICByZXR1cm4gdmFsID49IG1pbkhvdXIgKiAxICYmXG4gICAgICAgICAgdmFsIDw9IG1heEhvdXIgKiAxICYmXG4gICAgICAgICAgKCF0aGlzLmFsbG93ZWRIb3VycyB8fCB0aGlzLmFsbG93ZWRIb3Vycyh2YWwpKVxuICAgICAgfVxuICAgIH0sXG4gICAgaXNBbGxvd2VkTWludXRlQ2IgKCkge1xuICAgICAgY29uc3QgaXNIb3VyQWxsb3dlZCA9ICF0aGlzLmFsbG93ZWRIb3VycyB8fCB0aGlzLmFsbG93ZWRIb3Vycyh0aGlzLmlucHV0SG91cilcbiAgICAgIGlmICghdGhpcy5taW4gJiYgIXRoaXMubWF4KSB7XG4gICAgICAgIHJldHVybiBpc0hvdXJBbGxvd2VkID8gdGhpcy5hbGxvd2VkTWludXRlcyA6ICgpID0+IGZhbHNlXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IFttaW5Ib3VyLCBtaW5NaW51dGVdID0gdGhpcy5taW4gPyB0aGlzLm1pbi5zcGxpdCgnOicpIDogWzAsIDBdXG4gICAgICBjb25zdCBbbWF4SG91ciwgbWF4TWludXRlXSA9IHRoaXMubWF4ID8gdGhpcy5tYXguc3BsaXQoJzonKSA6IFsyMywgNTldXG4gICAgICBjb25zdCBtaW5UaW1lID0gbWluSG91ciAqIDYwICsgbWluTWludXRlICogMVxuICAgICAgY29uc3QgbWF4VGltZSA9IG1heEhvdXIgKiA2MCArIG1heE1pbnV0ZSAqIDFcblxuICAgICAgcmV0dXJuIHZhbCA9PiB7XG4gICAgICAgIGNvbnN0IHRpbWUgPSA2MCAqIHRoaXMuaW5wdXRIb3VyICsgdmFsXG4gICAgICAgIHJldHVybiB0aW1lID49IG1pblRpbWUgJiZcbiAgICAgICAgICB0aW1lIDw9IG1heFRpbWUgJiZcbiAgICAgICAgICBpc0hvdXJBbGxvd2VkICYmXG4gICAgICAgICAgKCF0aGlzLmFsbG93ZWRNaW51dGVzIHx8IHRoaXMuYWxsb3dlZE1pbnV0ZXModmFsKSlcbiAgICAgIH1cbiAgICB9LFxuICAgIGlzQW1QbSAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5mb3JtYXQgPT09ICdhbXBtJ1xuICAgIH1cbiAgfSxcblxuICB3YXRjaDoge1xuICAgIHZhbHVlOiAnc2V0SW5wdXREYXRhJ1xuICB9LFxuXG4gIG1vdW50ZWQgKCkge1xuICAgIHRoaXMuc2V0SW5wdXREYXRhKHRoaXMudmFsdWUpXG4gIH0sXG5cbiAgbWV0aG9kczoge1xuICAgIGVtaXRWYWx1ZSAoKSB7XG4gICAgICBpZiAodGhpcy5pbnB1dEhvdXIgIT0gbnVsbCAmJiB0aGlzLmlucHV0TWludXRlICE9IG51bGwpIHtcbiAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCBgJHtwYWQodGhpcy5pbnB1dEhvdXIpfToke3BhZCh0aGlzLmlucHV0TWludXRlKX1gKVxuICAgICAgfVxuICAgIH0sXG4gICAgc2V0UGVyaW9kIChwZXJpb2QpIHtcbiAgICAgIHRoaXMucGVyaW9kID0gcGVyaW9kXG4gICAgICBpZiAodGhpcy5pbnB1dEhvdXIgIT0gbnVsbCkge1xuICAgICAgICBjb25zdCBuZXdIb3VyID0gdGhpcy5pbnB1dEhvdXIgKyAocGVyaW9kID09PSAnYW0nID8gLTEyIDogMTIpXG4gICAgICAgIHRoaXMuaW5wdXRIb3VyID0gdGhpcy5maXJzdEFsbG93ZWQoJ2hvdXInLCBuZXdIb3VyKVxuICAgICAgICB0aGlzLmVtaXRWYWx1ZSgpXG4gICAgICB9XG4gICAgfSxcbiAgICBzZXRJbnB1dERhdGEgKHZhbHVlKSB7XG4gICAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1ZSA9PT0gJycpIHtcbiAgICAgICAgdGhpcy5pbnB1dEhvdXIgPSBudWxsXG4gICAgICAgIHRoaXMuaW5wdXRNaW51dGUgPSBudWxsXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgIHRoaXMuaW5wdXRIb3VyID0gdmFsdWUuZ2V0SG91cnMoKVxuICAgICAgICB0aGlzLmlucHV0TWludXRlID0gdmFsdWUuZ2V0TWludXRlcygpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBbLCBob3VyLCBtaW51dGUsICwgcGVyaW9kXSA9IHZhbHVlLnRyaW0oKS50b0xvd2VyQ2FzZSgpLm1hdGNoKC9eKFxcZCspOihcXGQrKSg6XFxkKyk/KFthcF1tKT8kLywgJycpIHx8IFtdXG5cbiAgICAgICAgdGhpcy5pbnB1dEhvdXIgPSBwZXJpb2QgPyB0aGlzLmNvbnZlcnQxMnRvMjQocGFyc2VJbnQoaG91ciwgMTApLCBwZXJpb2QpIDogcGFyc2VJbnQoaG91ciwgMTApXG4gICAgICAgIHRoaXMuaW5wdXRNaW51dGUgPSBwYXJzZUludChtaW51dGUsIDEwKVxuICAgICAgfVxuXG4gICAgICB0aGlzLnBlcmlvZCA9IHRoaXMuaW5wdXRIb3VyIDwgMTIgPyAnYW0nIDogJ3BtJ1xuICAgIH0sXG4gICAgY29udmVydDI0dG8xMiAoaG91cikge1xuICAgICAgcmV0dXJuIGhvdXIgPyAoKGhvdXIgLSAxKSAlIDEyICsgMSkgOiAxMlxuICAgIH0sXG4gICAgY29udmVydDEydG8yNCAoaG91ciwgcGVyaW9kKSB7XG4gICAgICByZXR1cm4gaG91ciAlIDEyICsgKHBlcmlvZCA9PT0gJ3BtJyA/IDEyIDogMClcbiAgICB9LFxuICAgIG9uSW5wdXQgKHZhbHVlKSB7XG4gICAgICBpZiAodGhpcy5zZWxlY3RpbmdIb3VyKSB7XG4gICAgICAgIHRoaXMuaW5wdXRIb3VyID0gdGhpcy5pc0FtUG0gPyB0aGlzLmNvbnZlcnQxMnRvMjQodmFsdWUsIHRoaXMucGVyaW9kKSA6IHZhbHVlXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmlucHV0TWludXRlID0gdmFsdWVcbiAgICAgIH1cbiAgICAgIHRoaXMuZW1pdFZhbHVlKClcbiAgICB9LFxuICAgIG9uQ2hhbmdlICgpIHtcbiAgICAgIGlmICghdGhpcy5zZWxlY3RpbmdIb3VyKSB7XG4gICAgICAgIHRoaXMuJGVtaXQoJ2NoYW5nZScsIHRoaXMudmFsdWUpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNlbGVjdGluZ0hvdXIgPSBmYWxzZVxuICAgICAgfVxuICAgIH0sXG4gICAgZmlyc3RBbGxvd2VkICh0eXBlLCB2YWx1ZSkge1xuICAgICAgY29uc3QgYWxsb3dlZEZuID0gdHlwZSA9PT0gJ2hvdXInID8gdGhpcy5pc0FsbG93ZWRIb3VyQ2IgOiB0aGlzLmlzQWxsb3dlZE1pbnV0ZUNiXG4gICAgICBpZiAoIWFsbG93ZWRGbikgcmV0dXJuIHZhbHVlXG5cbiAgICAgIC8vIFRPRE86IGNsZWFuIHVwXG4gICAgICBjb25zdCByYW5nZSA9IHR5cGUgPT09ICdtaW51dGUnXG4gICAgICAgID8gcmFuZ2VNaW51dGVzXG4gICAgICAgIDogKHRoaXMuaXNBbVBtXG4gICAgICAgICAgPyAodmFsdWUgPCAxMlxuICAgICAgICAgICAgPyByYW5nZUhvdXJzMTJhbVxuICAgICAgICAgICAgOiByYW5nZUhvdXJzMTJwbSlcbiAgICAgICAgICA6IHJhbmdlSG91cnMyNClcbiAgICAgIGNvbnN0IGZpcnN0ID0gcmFuZ2UuZmluZCh2ID0+IGFsbG93ZWRGbigodiArIHZhbHVlKSAlIHJhbmdlLmxlbmd0aCArIHJhbmdlWzBdKSlcbiAgICAgIHJldHVybiAoKGZpcnN0IHx8IDApICsgdmFsdWUpICUgcmFuZ2UubGVuZ3RoICsgcmFuZ2VbMF1cbiAgICB9LFxuICAgIGdlbkNsb2NrICgpIHtcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KFZUaW1lUGlja2VyQ2xvY2ssIHtcbiAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICBhbGxvd2VkVmFsdWVzOiB0aGlzLnNlbGVjdGluZ0hvdXIgPyB0aGlzLmlzQWxsb3dlZEhvdXJDYiA6IHRoaXMuaXNBbGxvd2VkTWludXRlQ2IsXG4gICAgICAgICAgY29sb3I6IHRoaXMuY29sb3IsXG4gICAgICAgICAgZGFyazogdGhpcy5kYXJrLFxuICAgICAgICAgIGRvdWJsZTogdGhpcy5zZWxlY3RpbmdIb3VyICYmICF0aGlzLmlzQW1QbSxcbiAgICAgICAgICBmb3JtYXQ6IHRoaXMuc2VsZWN0aW5nSG91ciA/ICh0aGlzLmlzQW1QbSA/IHRoaXMuY29udmVydDI0dG8xMiA6IHZhbCA9PiB2YWwpIDogdmFsID0+IHBhZCh2YWwsIDIpLFxuICAgICAgICAgIGxpZ2h0OiB0aGlzLmxpZ2h0LFxuICAgICAgICAgIG1heDogdGhpcy5zZWxlY3RpbmdIb3VyID8gKHRoaXMuaXNBbVBtICYmIHRoaXMucGVyaW9kID09PSAnYW0nID8gMTEgOiAyMykgOiA1OSxcbiAgICAgICAgICBtaW46IHRoaXMuc2VsZWN0aW5nSG91ciAmJiB0aGlzLmlzQW1QbSAmJiB0aGlzLnBlcmlvZCA9PT0gJ3BtJyA/IDEyIDogMCxcbiAgICAgICAgICByZWFkb25seTogdGhpcy5yZWFkb25seSxcbiAgICAgICAgICBzY3JvbGxhYmxlOiB0aGlzLnNjcm9sbGFibGUsXG4gICAgICAgICAgc2l6ZTogdGhpcy53aWR0aCAtICgoIXRoaXMuZnVsbFdpZHRoICYmIHRoaXMubGFuZHNjYXBlKSA/IDgwIDogMjApLFxuICAgICAgICAgIHN0ZXA6IHRoaXMuc2VsZWN0aW5nSG91ciA/IDEgOiA1LFxuICAgICAgICAgIHZhbHVlOiB0aGlzLnNlbGVjdGluZ0hvdXIgPyB0aGlzLmlucHV0SG91ciA6IHRoaXMuaW5wdXRNaW51dGVcbiAgICAgICAgfSxcbiAgICAgICAgb246IHtcbiAgICAgICAgICBpbnB1dDogdGhpcy5vbklucHV0LFxuICAgICAgICAgIGNoYW5nZTogdGhpcy5vbkNoYW5nZVxuICAgICAgICB9LFxuICAgICAgICByZWY6ICdjbG9jaydcbiAgICAgIH0pXG4gICAgfSxcbiAgICBnZW5QaWNrZXJCb2R5ICgpIHtcbiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCdkaXYnLCB7XG4gICAgICAgIHN0YXRpY0NsYXNzOiAndi10aW1lLXBpY2tlci1jbG9ja19fY29udGFpbmVyJyxcbiAgICAgICAga2V5OiB0aGlzLnNlbGVjdGluZ0hvdXJcbiAgICAgIH0sIFt0aGlzLmdlbkNsb2NrKCldKVxuICAgIH0sXG4gICAgZ2VuUGlja2VyVGl0bGUgKCkge1xuICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoVlRpbWVQaWNrZXJUaXRsZSwge1xuICAgICAgICBwcm9wczoge1xuICAgICAgICAgIGFtcG06IHRoaXMuaXNBbVBtLFxuICAgICAgICAgIGhvdXI6IHRoaXMuaW5wdXRIb3VyLFxuICAgICAgICAgIG1pbnV0ZTogdGhpcy5pbnB1dE1pbnV0ZSxcbiAgICAgICAgICBwZXJpb2Q6IHRoaXMucGVyaW9kLFxuICAgICAgICAgIHJlYWRvbmx5OiB0aGlzLnJlYWRvbmx5LFxuICAgICAgICAgIHNlbGVjdGluZ0hvdXI6IHRoaXMuc2VsZWN0aW5nSG91clxuICAgICAgICB9LFxuICAgICAgICBvbjoge1xuICAgICAgICAgICd1cGRhdGU6c2VsZWN0aW5nSG91cic6IHZhbHVlID0+ICh0aGlzLnNlbGVjdGluZ0hvdXIgPSB2YWx1ZSksXG4gICAgICAgICAgJ3VwZGF0ZTpwZXJpb2QnOiB0aGlzLnNldFBlcmlvZFxuICAgICAgICB9LFxuICAgICAgICByZWY6ICd0aXRsZScsXG4gICAgICAgIHNsb3Q6ICd0aXRsZSdcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIHJlbmRlciAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2VuUGlja2VyKCd2LXBpY2tlci0tdGltZScpXG4gIH1cbn1cbiJdfQ==