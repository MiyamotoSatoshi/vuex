// Styles
import '../../stylus/components/_treeview.styl';
// Components
import VTreeviewNode, { VTreeviewNodeProps } from './VTreeviewNode';
// Mixins
import Themeable from '../../mixins/themeable';
import { provide as RegistrableProvide } from '../../mixins/registrable';
// Utils
import { getObjectValueByPath, deepEqual } from '../../util/helpers';
import mixins from '../../util/mixins';
import { consoleWarn } from '../../util/console';
function ston(s) {
    const n = Number(s);
    return !isNaN(n) ? n : s;
}
export default mixins(RegistrableProvide('treeview'), Themeable
/* @vue/component */
).extend({
    name: 'v-treeview',
    provide() {
        return { treeview: this };
    },
    props: {
        active: {
            type: Array,
            default: () => ([])
        },
        items: {
            type: Array,
            default: () => ([])
        },
        hoverable: Boolean,
        multipleActive: Boolean,
        open: {
            type: Array,
            default: () => ([])
        },
        openAll: Boolean,
        value: {
            type: Array,
            default: () => ([])
        },
        ...VTreeviewNodeProps
    },
    data: () => ({
        nodes: {},
        selectedCache: new Set(),
        activeCache: new Set(),
        openCache: new Set()
    }),
    watch: {
        items: {
            handler() {
                // We only care if nodes are removed or added
                if (Object.keys(this.nodes).length === this.countItems(this.items))
                    return;
                const oldSelectedCache = [...this.selectedCache];
                this.selectedCache = new Set();
                this.activeCache = new Set();
                this.openCache = new Set();
                this.buildTree(this.items);
                // Only emit selected if selection has changed
                // as a result of items changing. This fixes a
                // potential double emit when selecting a node
                // with dynamic children
                if (!deepEqual(oldSelectedCache, [...this.selectedCache]))
                    this.emitSelected();
            },
            deep: true
        },
        active(value) {
            const old = [...this.activeCache];
            if (!value || deepEqual(old, value))
                return;
            old.forEach(key => this.updateActive(key, false));
            value.forEach(key => this.updateActive(key, true));
            this.emitActive();
        },
        value(value) {
            const old = [...this.selectedCache];
            if (!value || deepEqual(old, value))
                return;
            old.forEach(key => this.updateSelected(key, false));
            value.forEach(key => this.updateSelected(key, true));
            this.emitSelected();
        },
        open(value) {
            const old = [...this.openCache];
            if (deepEqual(old, value))
                return;
            old.forEach(key => this.updateOpen(key, false));
            value.forEach(key => this.updateOpen(key, true));
            this.emitOpen();
        }
    },
    created() {
        this.buildTree(this.items);
        this.value.forEach(key => this.updateSelected(key, true));
        this.emitSelected();
        this.active.forEach(key => this.updateActive(key, true));
        this.emitActive();
    },
    mounted() {
        // Save the developer from themselves
        if (this.$slots.prepend || this.$slots.append) {
            consoleWarn('The prepend and append slots require a slot-scope attribute', this);
        }
        if (this.openAll) {
            Object.keys(this.nodes).forEach(key => this.updateOpen(ston(key), true));
        }
        else {
            this.open.forEach(key => this.updateOpen(key, true));
        }
        this.emitOpen();
    },
    methods: {
        buildTree(items, parent = null) {
            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                const key = getObjectValueByPath(item, this.itemKey);
                const children = getObjectValueByPath(item, this.itemChildren, []);
                const oldNode = this.nodes.hasOwnProperty(key) ? this.nodes[key] : {
                    isSelected: false, isIndeterminate: false, isActive: false, isOpen: false, vnode: null
                };
                const node = {
                    vnode: oldNode.vnode,
                    parent,
                    children: children.map((c) => getObjectValueByPath(c, this.itemKey))
                };
                this.buildTree(children, key);
                // This fixed bug with dynamic children resetting selected parent state
                if (!this.nodes.hasOwnProperty(key) && parent !== null && this.nodes.hasOwnProperty(parent)) {
                    node.isSelected = this.nodes[parent].isSelected;
                    node.isIndeterminate = this.nodes[parent].isIndeterminate;
                }
                else {
                    node.isSelected = oldNode.isSelected;
                    node.isIndeterminate = oldNode.isIndeterminate;
                }
                node.isActive = oldNode.isActive;
                node.isOpen = oldNode.isOpen;
                this.nodes[key] = !children.length ? node : this.calculateState(node, this.nodes);
                // Don't forget to rebuild cache
                if (this.nodes[key].isSelected)
                    this.selectedCache.add(key);
                if (this.nodes[key].isActive)
                    this.activeCache.add(key);
                if (this.nodes[key].isOpen)
                    this.openCache.add(key);
                this.updateVnodeState(key);
            }
        },
        countItems(items) {
            let count = 0;
            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                count += 1;
                count += item.children ? this.countItems(item.children) : 0;
            }
            return count;
        },
        calculateState(node, state) {
            const counts = node.children.reduce((counts, child) => {
                counts[0] += +Boolean(state[child].isSelected);
                counts[1] += +Boolean(state[child].isIndeterminate);
                return counts;
            }, [0, 0]);
            node.isSelected = !!node.children.length && counts[0] === node.children.length;
            node.isIndeterminate = !node.isSelected && (counts[0] > 0 || counts[1] > 0);
            return node;
        },
        emitOpen() {
            this.$emit('update:open', [...this.openCache]);
        },
        emitSelected() {
            this.$emit('input', [...this.selectedCache]);
        },
        emitActive() {
            this.$emit('update:active', [...this.activeCache]);
        },
        getDescendants(key, descendants = []) {
            const children = this.nodes[key].children;
            descendants.push(...children);
            for (let i = 0; i < children.length; i++) {
                descendants = this.getDescendants(children[i], descendants);
            }
            return descendants;
        },
        getParents(key) {
            let parent = this.nodes[key].parent;
            const parents = [];
            while (parent !== null) {
                parents.push(parent);
                parent = this.nodes[parent].parent;
            }
            return parents;
        },
        register(node) {
            const key = getObjectValueByPath(node.item, this.itemKey);
            this.nodes[key].vnode = node;
            this.updateVnodeState(key);
        },
        unregister(node) {
            const key = getObjectValueByPath(node.item, this.itemKey);
            this.nodes[key].vnode = null;
        },
        updateActive(key, isActive) {
            if (!this.nodes.hasOwnProperty(key))
                return;
            if (!this.multipleActive) {
                this.activeCache.forEach(active => {
                    this.nodes[active].isActive = false;
                    this.updateVnodeState(active);
                    this.activeCache.delete(active);
                });
            }
            const node = this.nodes[key];
            if (!node)
                return;
            if (isActive)
                this.activeCache.add(key);
            else
                this.activeCache.delete(key);
            node.isActive = isActive;
            this.updateVnodeState(key);
        },
        updateSelected(key, isSelected) {
            if (!this.nodes.hasOwnProperty(key))
                return;
            const changed = {};
            const descendants = [key, ...this.getDescendants(key)];
            descendants.forEach(descendant => {
                this.nodes[descendant].isSelected = isSelected;
                this.nodes[descendant].isIndeterminate = false;
                changed[descendant] = isSelected;
            });
            const parents = this.getParents(key);
            parents.forEach(parent => {
                this.nodes[parent] = this.calculateState(this.nodes[parent], this.nodes);
                changed[parent] = this.nodes[parent].isSelected;
            });
            const all = [key, ...descendants, ...parents];
            all.forEach(this.updateVnodeState);
            Object.keys(changed).forEach(k => {
                changed[k] === true ? this.selectedCache.add(ston(k)) : this.selectedCache.delete(ston(k));
            });
        },
        updateOpen(key, isOpen) {
            if (!this.nodes.hasOwnProperty(key))
                return;
            const node = this.nodes[key];
            if (node.children && !node.children.length && node.vnode && !node.vnode.hasLoaded) {
                node.vnode.checkChildren().then(() => this.updateOpen(key, isOpen));
            }
            else {
                node.isOpen = isOpen;
                node.isOpen ? this.openCache.add(key) : this.openCache.delete(key);
                this.updateVnodeState(key);
            }
        },
        updateVnodeState(key) {
            const node = this.nodes[key];
            if (node && node.vnode) {
                node.vnode.isSelected = node.isSelected;
                node.vnode.isIndeterminate = node.isIndeterminate;
                node.vnode.isActive = node.isActive;
                node.vnode.isOpen = node.isOpen;
            }
        }
    },
    render(h) {
        const children = this.items.length
            ? this.items.map(VTreeviewNode.options.methods.genChild.bind(this))
            /* istanbul ignore next */
            : this.$slots.default;
        return h('div', {
            staticClass: 'v-treeview',
            class: {
                'v-treeview--hoverable': this.hoverable,
                ...this.themeClasses
            }
        }, children);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVlRyZWV2aWV3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVlRyZWV2aWV3L1ZUcmVldmlldy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxTQUFTO0FBQ1QsT0FBTyx3Q0FBd0MsQ0FBQTtBQU0vQyxhQUFhO0FBQ2IsT0FBTyxhQUFhLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlCQUFpQixDQUFBO0FBRW5FLFNBQVM7QUFDVCxPQUFPLFNBQVMsTUFBTSx3QkFBd0IsQ0FBQTtBQUM5QyxPQUFPLEVBQUUsT0FBTyxJQUFJLGtCQUFrQixFQUFFLE1BQU0sMEJBQTBCLENBQUE7QUFFeEUsUUFBUTtBQUNSLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxTQUFTLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUNwRSxPQUFPLE1BQU0sTUFBTSxtQkFBbUIsQ0FBQTtBQUN0QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFpQmhELFNBQVMsSUFBSSxDQUFFLENBQWtCO0lBQy9CLE1BQU0sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUNuQixPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUMxQixDQUFDO0FBRUQsZUFBZSxNQUFNLENBQ25CLGtCQUFrQixDQUFDLFVBQVUsQ0FBQyxFQUM5QixTQUFTO0FBQ1Qsb0JBQW9CO0NBQ3JCLENBQUMsTUFBTSxDQUFDO0lBQ1AsSUFBSSxFQUFFLFlBQVk7SUFFbEIsT0FBTztRQUNMLE9BQU8sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUE7SUFDM0IsQ0FBQztJQUVELEtBQUssRUFBRTtRQUNMLE1BQU0sRUFBRTtZQUNOLElBQUksRUFBRSxLQUFLO1lBQ1gsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFD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Q0FBQTtnQkFDakQsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQTtnQkFDbkMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQTthQUNoQztRQUNILENBQUM7S0FDRjtJQUVELE1BQU0sQ0FBRSxDQUFDO1FBQ1AsTUFBTSxRQUFRLEdBQStCLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTTtZQUM1RCxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNuRSwwQkFBMEI7WUFDMUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFBO1FBRXZCLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRTtZQUNkLFdBQVcsRUFBRSxZQUFZO1lBQ3pCLEtBQUssRUFBRTtnQkFDTCx1QkFBdUIsRUFBRSxJQUFJLENBQUMsU0FBUztnQkFDdkMsR0FBRyxJQUFJLENBQUMsWUFBWTthQUNyQjtTQUNGLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDZCxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gU3R5bGVzXG5pbXBvcnQgJy4uLy4uL3N0eWx1cy9jb21wb25lbnRzL190cmVldmlldy5zdHlsJ1xuXG4vLyBUeXBlc1xuaW1wb3J0IHsgVk5vZGUsIFZOb2RlQ2hpbGRyZW5BcnJheUNvbnRlbnRzIH0gZnJvbSAndnVlJ1xuaW1wb3J0IHsgUHJvcFZhbGlkYXRvciB9IGZyb20gJ3Z1ZS90eXBlcy9vcHRpb25zJ1xuXG4vLyBDb21wb25lbnRzXG5pbXBvcnQgVlRyZWV2aWV3Tm9kZSwgeyBWVHJlZXZpZXdOb2RlUHJvcHMgfSBmcm9tICcuL1ZUcmVldmlld05vZGUnXG5cbi8vIE1peGluc1xuaW1wb3J0IFRoZW1lYWJsZSBmcm9tICcuLi8uLi9taXhpbnMvdGhlbWVhYmxlJ1xuaW1wb3J0IHsgcHJvdmlkZSBhcyBSZWdpc3RyYWJsZVByb3ZpZGUgfSBmcm9tICcuLi8uLi9taXhpbnMvcmVnaXN0cmFibGUnXG5cbi8vIFV0aWxzXG5pbXBvcnQgeyBnZXRPYmplY3RWYWx1ZUJ5UGF0aCwgZGVlcEVxdWFsIH0gZnJvbSAnLi4vLi4vdXRpbC9oZWxwZXJzJ1xuaW1wb3J0IG1peGlucyBmcm9tICcuLi8uLi91dGlsL21peGlucydcbmltcG9ydCB7IGNvbnNvbGVXYXJuIH0gZnJvbSAnLi4vLi4vdXRpbC9jb25zb2xlJ1xuXG50eXBlIFZUcmVldmlld05vZGVJbnN0YW5jZSA9IEluc3RhbmNlVHlwZTx0eXBlb2YgVlRyZWV2aWV3Tm9kZT5cblxudHlwZSBOb2RlQ2FjaGUgPSBTZXQ8c3RyaW5nIHwgbnVtYmVyPlxudHlwZSBOb2RlQXJyYXkgPSAoc3RyaW5nIHwgbnVtYmVyKVtdXG5cbnR5cGUgTm9kZVN0YXRlID0ge1xuICBwYXJlbnQ6IG51bWJlciB8IHN0cmluZyB8IG51bGxcbiAgY2hpbGRyZW46IChudW1iZXIgfCBzdHJpbmcpW11cbiAgdm5vZGU6IFZUcmVldmlld05vZGVJbnN0YW5jZSB8IG51bGxcbiAgaXNBY3RpdmU6IGJvb2xlYW5cbiAgaXNTZWxlY3RlZDogYm9vbGVhblxuICBpc0luZGV0ZXJtaW5hdGU6IGJvb2xlYW5cbiAgaXNPcGVuOiBib29sZWFuXG59XG5cbmZ1bmN0aW9uIHN0b24gKHM6IHN0cmluZyB8IG51bWJlcikge1xuICBjb25zdCBuID0gTnVtYmVyKHMpXG4gIHJldHVybiAhaXNOYU4obikgPyBuIDogc1xufVxuXG5leHBvcnQgZGVmYXVsdCBtaXhpbnMoXG4gIFJlZ2lzdHJhYmxlUHJvdmlkZSgndHJlZXZpZXcnKSxcbiAgVGhlbWVhYmxlXG4gIC8qIEB2dWUvY29tcG9uZW50ICovXG4pLmV4dGVuZCh7XG4gIG5hbWU6ICd2LXRyZWV2aWV3JyxcblxuICBwcm92aWRlICgpOiBvYmplY3Qge1xuICAgIHJldHVybiB7IHRyZWV2aWV3OiB0aGlzIH1cbiAgfSxcblxuICBwcm9wczoge1xuICAgIGFjdGl2ZToge1xuICAgICAgdHlwZTogQXJyYXksXG4gICAgICBkZWZhdWx0OiAoKSA9PiAoW10pXG4gICAgfSBhcyBQcm9wVmFsaWRhdG9yPE5vZGVBcnJheT4sXG4gICAgaXRlbXM6IHtcbiAgICAgIHR5cGU6IEFycmF5LFxuICAgICAgZGVmYXVsdDogKCkgPT4gKFtdKVxuICAgIH0gYXMgUHJvcFZhbGlkYXRvcjxhbnlbXT4sXG4gICAgaG92ZXJhYmxlOiBCb29sZWFuLFxuICAgIG11bHRpcGxlQWN0aXZlOiBCb29sZWFuLFxuICAgIG9wZW46IHtcbiAgICAgIHR5cGU6IEFycmF5LFxuICAgICAgZGVmYXVsdDogKCkgPT4gKFtdKVxuICAgIH0gYXMgUHJvcFZhbGlkYXRvcjxOb2RlQXJyYXk+LFxuICAgIG9wZW5BbGw6IEJvb2xlYW4sXG4gICAgdmFsdWU6IHtcbiAgICAgIHR5cGU6IEFycmF5LFxuICAgICAgZGVmYXVsdDogKCkgPT4gKFtdKVxuICAgIH0gYXMgUHJvcFZhbGlkYXRvcjxOb2RlQXJyYXk+LFxuICAgIC4uLlZUcmVldmlld05vZGVQcm9wc1xuICB9LFxuXG4gIGRhdGE6ICgpID0+ICh7XG4gICAgbm9kZXM6IHt9IGFzIFJlY29yZDxzdHJpbmcgfCBudW1iZXIsIE5vZGVTdGF0ZT4sXG4gICAgc2VsZWN0ZWRDYWNoZTogbmV3IFNldCgpIGFzIE5vZGVDYWNoZSxcbiAgICBhY3RpdmVDYWNoZTogbmV3IFNldCgpIGFzIE5vZGVDYWNoZSxcbiAgICBvcGVuQ2FjaGU6IG5ldyBTZXQoKSBhcyBOb2RlQ2FjaGVcbiAgfSksXG5cbiAgd2F0Y2g6IHtcbiAgICBpdGVtczoge1xuICAgICAgaGFuZGxlciAoKSB7XG4gICAgICAgIC8vIFdlIG9ubHkgY2FyZSBpZiBub2RlcyBhcmUgcmVtb3ZlZCBvciBhZGRlZFxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5ub2RlcykubGVuZ3RoID09PSB0aGlzLmNvdW50SXRlbXModGhpcy5pdGVtcykpIHJldHVyblxuXG4gICAgICAgIGNvbnN0IG9sZFNlbGVjdGVkQ2FjaGUgPSBbLi4udGhpcy5zZWxlY3RlZENhY2hlXVxuICAgICAgICB0aGlzLnNlbGVjdGVkQ2FjaGUgPSBuZXcgU2V0KClcbiAgICAgICAgdGhpcy5hY3RpdmVDYWNoZSA9IG5ldyBTZXQoKVxuICAgICAgICB0aGlzLm9wZW5DYWNoZSA9IG5ldyBTZXQoKVxuICAgICAgICB0aGlzLmJ1aWxkVHJlZSh0aGlzLml0ZW1zKVxuXG4gICAgICAgIC8vIE9ubHkgZW1pdCBzZWxlY3RlZCBpZiBzZWxlY3Rpb24gaGFzIGNoYW5nZWRcbiAgICAgICAgLy8gYXMgYSByZXN1bHQgb2YgaXRlbXMgY2hhbmdpbmcuIFRoaXMgZml4ZXMgYVxuICAgICAgICAvLyBwb3RlbnRpYWwgZG91YmxlIGVtaXQgd2hlbiBzZWxlY3RpbmcgYSBub2RlXG4gICAgICAgIC8vIHdpdGggZHluYW1pYyBjaGlsZHJlblxuICAgICAgICBpZiAoIWRlZXBFcXVhbChvbGRTZWxlY3RlZENhY2hlLCBbLi4udGhpcy5zZWxlY3RlZENhY2hlXSkpIHRoaXMuZW1pdFNlbGVjdGVkKClcbiAgICAgIH0sXG4gICAgICBkZWVwOiB0cnVlXG4gICAgfSxcbiAgICBhY3RpdmUgKHZhbHVlOiAoc3RyaW5nIHwgbnVtYmVyKVtdKSB7XG4gICAgICBjb25zdCBvbGQgPSBbLi4udGhpcy5hY3RpdmVDYWNoZV1cbiAgICAgIGlmICghdmFsdWUgfHwgZGVlcEVxdWFsKG9sZCwgdmFsdWUpKSByZXR1cm5cblxuICAgICAgb2xkLmZvckVhY2goa2V5ID0+IHRoaXMudXBkYXRlQWN0aXZlKGtleSwgZmFsc2UpKVxuICAgICAgdmFsdWUuZm9yRWFjaChrZXkgPT4gdGhpcy51cGRhdGVBY3RpdmUoa2V5LCB0cnVlKSlcbiAgICAgIHRoaXMuZW1pdEFjdGl2ZSgpXG4gICAgfSxcbiAgICB2YWx1ZSAodmFsdWU6IChzdHJpbmcgfCBudW1iZXIpW10pIHtcbiAgICAgIGNvbnN0IG9sZCA9IFsuLi50aGlzLnNlbGVjdGVkQ2FjaGVdXG4gICAgICBpZiAoIXZhbHVlIHx8IGRlZXBFcXVhbChvbGQsIHZhbHVlKSkgcmV0dXJuXG5cbiAgICAgIG9sZC5mb3JFYWNoKGtleSA9PiB0aGlzLnVwZGF0ZVNlbGVjdGVkKGtleSwgZmFsc2UpKVxuICAgICAgdmFsdWUuZm9yRWFjaChrZXkgPT4gdGhpcy51cGRhdGVTZWxlY3RlZChrZXksIHRydWUpKVxuICAgICAgdGhpcy5lbWl0U2VsZWN0ZWQoKVxuICAgIH0sXG4gICAgb3BlbiAodmFsdWU6IChzdHJpbmcgfCBudW1iZXIpW10pIHtcbiAgICAgIGNvbnN0IG9sZCA9IFsuLi50aGlzLm9wZW5DYWNoZV1cbiAgICAgIGlmIChkZWVwRXF1YWwob2xkLCB2YWx1ZSkpIHJldHVyblxuXG4gICAgICBvbGQuZm9yRWFjaChrZXkgPT4gdGhpcy51cGRhdGVPcGVuKGtleSwgZmFsc2UpKVxuICAgICAgdmFsdWUuZm9yRWFjaChrZXkgPT4gdGhpcy51cGRhdGVPcGVuKGtleSwgdHJ1ZSkpXG4gICAgICB0aGlzLmVtaXRPcGVuKClcbiAgICB9XG4gIH0sXG5cbiAgY3JlYXRlZCAoKSB7XG4gICAgdGhpcy5idWlsZFRyZWUodGhpcy5pdGVtcylcbiAgICB0aGlzLnZhbHVlLmZvckVhY2goa2V5ID0+IHRoaXMudXBkYXRlU2VsZWN0ZWQoa2V5LCB0cnVlKSlcbiAgICB0aGlzLmVtaXRTZWxlY3RlZCgpXG4gICAgdGhpcy5hY3RpdmUuZm9yRWFjaChrZXkgPT4gdGhpcy51cGRhdGVBY3RpdmUoa2V5LCB0cnVlKSlcbiAgICB0aGlzLmVtaXRBY3RpdmUoKVxuICB9LFxuXG4gIG1vdW50ZWQgKCkge1xuICAgIC8vIFNhdmUgdGhlIGRldmVsb3BlciBmcm9tIHRoZW1zZWx2ZXNcbiAgICBpZiAodGhpcy4kc2xvdHMucHJlcGVuZCB8fCB0aGlzLiRzbG90cy5hcHBlbmQpIHtcbiAgICAgIGNvbnNvbGVXYXJuKCdUaGUgcHJlcGVuZCBhbmQgYXBwZW5kIHNsb3RzIHJlcXVpcmUgYSBzbG90LXNjb3BlIGF0dHJpYnV0ZScsIHRoaXMpXG4gICAgfVxuXG4gICAgaWYgKHRoaXMub3BlbkFsbCkge1xuICAgICAgT2JqZWN0LmtleXModGhpcy5ub2RlcykuZm9yRWFjaChrZXkgPT4gdGhpcy51cGRhdGVPcGVuKHN0b24oa2V5KSwgdHJ1ZSkpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub3Blbi5mb3JFYWNoKGtleSA9PiB0aGlzLnVwZGF0ZU9wZW4oa2V5LCB0cnVlKSlcbiAgICB9XG5cbiAgICB0aGlzLmVtaXRPcGVuKClcbiAgfSxcblxuICBtZXRob2RzOiB7XG4gICAgYnVpbGRUcmVlIChpdGVtczogYW55W10sIHBhcmVudDogKHN0cmluZyB8IG51bWJlciB8IG51bGwpID0gbnVsbCkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBpdGVtID0gaXRlbXNbaV1cbiAgICAgICAgY29uc3Qga2V5ID0gZ2V0T2JqZWN0VmFsdWVCeVBhdGgoaXRlbSwgdGhpcy5pdGVtS2V5KVxuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IGdldE9iamVjdFZhbHVlQnlQYXRoKGl0ZW0sIHRoaXMuaXRlbUNoaWxkcmVuLCBbXSlcbiAgICAgICAgY29uc3Qgb2xkTm9kZSA9IHRoaXMubm9kZXMuaGFzT3duUHJvcGVydHkoa2V5KSA/IHRoaXMubm9kZXNba2V5XSA6IHtcbiAgICAgICAgICBpc1NlbGVjdGVkOiBmYWxzZSwgaXNJbmRldGVybWluYXRlOiBmYWxzZSwgaXNBY3RpdmU6IGZhbHNlLCBpc09wZW46IGZhbHNlLCB2bm9kZTogbnVsbFxuICAgICAgICB9IGFzIE5vZGVTdGF0ZVxuXG4gICAgICAgIGNvbnN0IG5vZGU6IGFueSA9IHtcbiAgICAgICAgICB2bm9kZTogb2xkTm9kZS52bm9kZSxcbiAgICAgICAgICBwYXJlbnQsXG4gICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuLm1hcCgoYzogYW55KSA9PiBnZXRPYmplY3RWYWx1ZUJ5UGF0aChjLCB0aGlzLml0ZW1LZXkpKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5idWlsZFRyZWUoY2hpbGRyZW4sIGtleSlcblxuICAgICAgICAvLyBUaGlzIGZpeGVkIGJ1ZyB3aXRoIGR5bmFtaWMgY2hpbGRyZW4gcmVzZXR0aW5nIHNlbGVjdGVkIHBhcmVudCBzdGF0ZVxuICAgICAgICBpZiAoIXRoaXMubm9kZXMuaGFzT3duUHJvcGVydHkoa2V5KSAmJiBwYXJlbnQgIT09IG51bGwgJiYgdGhpcy5ub2Rlcy5oYXNPd25Qcm9wZXJ0eShwYXJlbnQpKSB7XG4gICAgICAgICAgbm9kZS5pc1NlbGVjdGVkID0gdGhpcy5ub2Rlc1twYXJlbnRdLmlzU2VsZWN0ZWRcbiAgICAgICAgICBub2RlLmlzSW5kZXRlcm1pbmF0ZSA9IHRoaXMubm9kZXNbcGFyZW50XS5pc0luZGV0ZXJtaW5hdGVcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBub2RlLmlzU2VsZWN0ZWQgPSBvbGROb2RlLmlzU2VsZWN0ZWRcbiAgICAgICAgICBub2RlLmlzSW5kZXRlcm1pbmF0ZSA9IG9sZE5vZGUuaXNJbmRldGVybWluYXRlXG4gICAgICAgIH1cblxuICAgICAgICBub2RlLmlzQWN0aXZlID0gb2xkTm9kZS5pc0FjdGl2ZVxuICAgICAgICBub2RlLmlzT3BlbiA9IG9sZE5vZGUuaXNPcGVuXG5cbiAgICAgICAgdGhpcy5ub2Rlc1trZXldID0gIWNoaWxkcmVuLmxlbmd0aCA/IG5vZGUgOiB0aGlzLmNhbGN1bGF0ZVN0YXRlKG5vZGUsIHRoaXMubm9kZXMpXG5cbiAgICAgICAgLy8gRG9uJ3QgZm9yZ2V0IHRvIHJlYnVpbGQgY2FjaGVcbiAgICAgICAgaWYgKHRoaXMubm9kZXNba2V5XS5pc1NlbGVjdGVkKSB0aGlzLnNlbGVjdGVkQ2FjaGUuYWRkKGtleSlcbiAgICAgICAgaWYgKHRoaXMubm9kZXNba2V5XS5pc0FjdGl2ZSkgdGhpcy5hY3RpdmVDYWNoZS5hZGQoa2V5KVxuICAgICAgICBpZiAodGhpcy5ub2Rlc1trZXldLmlzT3BlbikgdGhpcy5vcGVuQ2FjaGUuYWRkKGtleSlcblxuICAgICAgICB0aGlzLnVwZGF0ZVZub2RlU3RhdGUoa2V5KVxuICAgICAgfVxuICAgIH0sXG4gICAgY291bnRJdGVtcyAoaXRlbXM6IGFueVtdKSB7XG4gICAgICBsZXQgY291bnQgPSAwXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSBpdGVtc1tpXVxuICAgICAgICBjb3VudCArPSAxXG4gICAgICAgIGNvdW50ICs9IGl0ZW0uY2hpbGRyZW4gPyB0aGlzLmNvdW50SXRlbXMoaXRlbS5jaGlsZHJlbikgOiAwXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb3VudFxuICAgIH0sXG4gICAgY2FsY3VsYXRlU3RhdGUgKG5vZGU6IE5vZGVTdGF0ZSwgc3RhdGU6IFJlY29yZDxzdHJpbmcgfCBudW1iZXIsIE5vZGVTdGF0ZT4pIHtcbiAgICAgIGNvbnN0IGNvdW50cyA9IG5vZGUuY2hpbGRyZW4ucmVkdWNlKChjb3VudHM6IG51bWJlcltdLCBjaGlsZDogc3RyaW5nIHwgbnVtYmVyKSA9PiB7XG4gICAgICAgIGNvdW50c1swXSArPSArQm9vbGVhbihzdGF0ZVtjaGlsZF0uaXNTZWxlY3RlZClcbiAgICAgICAgY291bnRzWzFdICs9ICtCb29sZWFuKHN0YXRlW2NoaWxkXS5pc0luZGV0ZXJtaW5hdGUpXG4gICAgICAgIHJldHVybiBjb3VudHNcbiAgICAgIH0sIFswLCAwXSlcblxuICAgICAgbm9kZS5pc1NlbGVjdGVkID0gISFub2RlLmNoaWxkcmVuLmxlbmd0aCAmJiBjb3VudHNbMF0gPT09IG5vZGUuY2hpbGRyZW4ubGVuZ3RoXG4gICAgICBub2RlLmlzSW5kZXRlcm1pbmF0ZSA9ICFub2RlLmlzU2VsZWN0ZWQgJiYgKGNvdW50c1swXSA+IDAgfHwgY291bnRzWzFdID4gMClcblxuICAgICAgcmV0dXJuIG5vZGVcbiAgICB9LFxuICAgIGVtaXRPcGVuICgpIHtcbiAgICAgIHRoaXMuJGVtaXQoJ3VwZGF0ZTpvcGVuJywgWy4uLnRoaXMub3BlbkNhY2hlXSlcbiAgICB9LFxuICAgIGVtaXRTZWxlY3RlZCAoKSB7XG4gICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIFsuLi50aGlzLnNlbGVjdGVkQ2FjaGVdKVxuICAgIH0sXG4gICAgZW1pdEFjdGl2ZSAoKSB7XG4gICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6YWN0aXZlJywgWy4uLnRoaXMuYWN0aXZlQ2FjaGVdKVxuICAgIH0sXG4gICAgZ2V0RGVzY2VuZGFudHMgKGtleTogc3RyaW5nIHwgbnVtYmVyLCBkZXNjZW5kYW50czogTm9kZUFycmF5ID0gW10pIHtcbiAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5ub2Rlc1trZXldLmNoaWxkcmVuXG5cbiAgICAgIGRlc2NlbmRhbnRzLnB1c2goLi4uY2hpbGRyZW4pXG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZGVzY2VuZGFudHMgPSB0aGlzLmdldERlc2NlbmRhbnRzKGNoaWxkcmVuW2ldLCBkZXNjZW5kYW50cylcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRlc2NlbmRhbnRzXG4gICAgfSxcbiAgICBnZXRQYXJlbnRzIChrZXk6IHN0cmluZyB8IG51bWJlcikge1xuICAgICAgbGV0IHBhcmVudCA9IHRoaXMubm9kZXNba2V5XS5wYXJlbnRcblxuICAgICAgY29uc3QgcGFyZW50cyA9IFtdXG4gICAgICB3aGlsZSAocGFyZW50ICE9PSBudWxsKSB7XG4gICAgICAgIHBhcmVudHMucHVzaChwYXJlbnQpXG4gICAgICAgIHBhcmVudCA9IHRoaXMubm9kZXNbcGFyZW50XS5wYXJlbnRcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHBhcmVudHNcbiAgICB9LFxuICAgIHJlZ2lzdGVyIChub2RlOiBWVHJlZXZpZXdOb2RlSW5zdGFuY2UpIHtcbiAgICAgIGNvbnN0IGtleSA9IGdldE9iamVjdFZhbHVlQnlQYXRoKG5vZGUuaXRlbSwgdGhpcy5pdGVtS2V5KVxuICAgICAgdGhpcy5ub2Rlc1trZXldLnZub2RlID0gbm9kZVxuXG4gICAgICB0aGlzLnVwZGF0ZVZub2RlU3RhdGUoa2V5KVxuICAgIH0sXG4gICAgdW5yZWdpc3RlciAobm9kZTogVlRyZWV2aWV3Tm9kZUluc3RhbmNlKSB7XG4gICAgICBjb25zdCBrZXkgPSBnZXRPYmplY3RWYWx1ZUJ5UGF0aChub2RlLml0ZW0sIHRoaXMuaXRlbUtleSlcbiAgICAgIHRoaXMubm9kZXNba2V5XS52bm9kZSA9IG51bGxcbiAgICB9LFxuICAgIHVwZGF0ZUFjdGl2ZSAoa2V5OiBzdHJpbmcgfCBudW1iZXIsIGlzQWN0aXZlOiBib29sZWFuKSB7XG4gICAgICBpZiAoIXRoaXMubm9kZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgcmV0dXJuXG5cbiAgICAgIGlmICghdGhpcy5tdWx0aXBsZUFjdGl2ZSkge1xuICAgICAgICB0aGlzLmFjdGl2ZUNhY2hlLmZvckVhY2goYWN0aXZlID0+IHtcbiAgICAgICAgICB0aGlzLm5vZGVzW2FjdGl2ZV0uaXNBY3RpdmUgPSBmYWxzZVxuICAgICAgICAgIHRoaXMudXBkYXRlVm5vZGVTdGF0ZShhY3RpdmUpXG4gICAgICAgICAgdGhpcy5hY3RpdmVDYWNoZS5kZWxldGUoYWN0aXZlKVxuICAgICAgICB9KVxuICAgICAgfVxuXG4gICAgICBjb25zdCBub2RlID0gdGhpcy5ub2Rlc1trZXldXG4gICAgICBpZiAoIW5vZGUpIHJldHVyblxuXG4gICAgICBpZiAoaXNBY3RpdmUpIHRoaXMuYWN0aXZlQ2FjaGUuYWRkKGtleSlcbiAgICAgIGVsc2UgdGhpcy5hY3RpdmVDYWNoZS5kZWxldGUoa2V5KVxuXG4gICAgICBub2RlLmlzQWN0aXZlID0gaXNBY3RpdmVcblxuICAgICAgdGhpcy51cGRhdGVWbm9kZVN0YXRlKGtleSlcbiAgICB9LFxuICAgIHVwZGF0ZVNlbGVjdGVkIChrZXk6IHN0cmluZyB8IG51bWJlciwgaXNTZWxlY3RlZDogYm9vbGVhbikge1xuICAgICAgaWYgKCF0aGlzLm5vZGVzLmhhc093blByb3BlcnR5KGtleSkpIHJldHVyblxuXG4gICAgICBjb25zdCBjaGFuZ2VkOiBSZWNvcmQ8c3RyaW5nIHwgbnVtYmVyLCBib29sZWFuPiA9IHt9XG5cbiAgICAgIGNvbnN0IGRlc2NlbmRhbnRzID0gW2tleSwgLi4udGhpcy5nZXREZXNjZW5kYW50cyhrZXkpXVxuICAgICAgZGVzY2VuZGFudHMuZm9yRWFjaChkZXNjZW5kYW50ID0+IHtcbiAgICAgICAgdGhpcy5ub2Rlc1tkZXNjZW5kYW50XS5pc1NlbGVjdGVkID0gaXNTZWxlY3RlZFxuICAgICAgICB0aGlzLm5vZGVzW2Rlc2NlbmRhbnRdLmlzSW5kZXRlcm1pbmF0ZSA9IGZhbHNlXG4gICAgICAgIGNoYW5nZWRbZGVzY2VuZGFudF0gPSBpc1NlbGVjdGVkXG4gICAgICB9KVxuXG4gICAgICBjb25zdCBwYXJlbnRzID0gdGhpcy5nZXRQYXJlbnRzKGtleSlcbiAgICAgIHBhcmVudHMuZm9yRWFjaChwYXJlbnQgPT4ge1xuICAgICAgICB0aGlzLm5vZGVzW3BhcmVudF0gPSB0aGlzLmNhbGN1bGF0ZVN0YXRlKHRoaXMubm9kZXNbcGFyZW50XSwgdGhpcy5ub2RlcylcbiAgICAgICAgY2hhbmdlZFtwYXJlbnRdID0gdGhpcy5ub2Rlc1twYXJlbnRdLmlzU2VsZWN0ZWRcbiAgICAgIH0pXG5cbiAgICAgIGNvbnN0IGFsbCA9IFtrZXksIC4uLmRlc2NlbmRhbnRzLCAuLi5wYXJlbnRzXVxuICAgICAgYWxsLmZvckVhY2godGhpcy51cGRhdGVWbm9kZVN0YXRlKVxuXG4gICAgICBPYmplY3Qua2V5cyhjaGFuZ2VkKS5mb3JFYWNoKGsgPT4ge1xuICAgICAgICBjaGFuZ2VkW2tdID09PSB0cnVlID8gdGhpcy5zZWxlY3RlZENhY2hlLmFkZChzdG9uKGspKSA6IHRoaXMuc2VsZWN0ZWRDYWNoZS5kZWxldGUoc3RvbihrKSlcbiAgICAgIH0pXG4gICAgfSxcbiAgICB1cGRhdGVPcGVuIChrZXk6IHN0cmluZyB8IG51bWJlciwgaXNPcGVuOiBib29sZWFuKSB7XG4gICAgICBpZiAoIXRoaXMubm9kZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgcmV0dXJuXG5cbiAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLm5vZGVzW2tleV1cblxuICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gJiYgIW5vZGUuY2hpbGRyZW4ubGVuZ3RoICYmIG5vZGUudm5vZGUgJiYgIW5vZGUudm5vZGUuaGFzTG9hZGVkKSB7XG4gICAgICAgIG5vZGUudm5vZGUuY2hlY2tDaGlsZHJlbigpLnRoZW4oKCkgPT4gdGhpcy51cGRhdGVPcGVuKGtleSwgaXNPcGVuKSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5vZGUuaXNPcGVuID0gaXNPcGVuXG5cbiAgICAgICAgbm9kZS5pc09wZW4gPyB0aGlzLm9wZW5DYWNoZS5hZGQoa2V5KSA6IHRoaXMub3BlbkNhY2hlLmRlbGV0ZShrZXkpXG5cbiAgICAgICAgdGhpcy51cGRhdGVWbm9kZVN0YXRlKGtleSlcbiAgICAgIH1cbiAgICB9LFxuICAgIHVwZGF0ZVZub2RlU3RhdGUgKGtleTogc3RyaW5nIHwgbnVtYmVyKSB7XG4gICAgICBjb25zdCBub2RlID0gdGhpcy5ub2Rlc1trZXldXG5cbiAgICAgIGlmIChub2RlICYmIG5vZGUudm5vZGUpIHtcbiAgICAgICAgbm9kZS52bm9kZS5pc1NlbGVjdGVkID0gbm9kZS5pc1NlbGVjdGVkXG4gICAgICAgIG5vZGUudm5vZGUuaXNJbmRldGVybWluYXRlID0gbm9kZS5pc0luZGV0ZXJtaW5hdGVcbiAgICAgICAgbm9kZS52bm9kZS5pc0FjdGl2ZSA9IG5vZGUuaXNBY3RpdmVcbiAgICAgICAgbm9kZS52bm9kZS5pc09wZW4gPSBub2RlLmlzT3BlblxuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICByZW5kZXIgKGgpOiBWTm9kZSB7XG4gICAgY29uc3QgY2hpbGRyZW46IFZOb2RlQ2hpbGRyZW5BcnJheUNvbnRlbnRzID0gdGhpcy5pdGVtcy5sZW5ndGhcbiAgICAgID8gdGhpcy5pdGVtcy5tYXAoVlRyZWV2aWV3Tm9kZS5vcHRpb25zLm1ldGhvZHMuZ2VuQ2hpbGQuYmluZCh0aGlzKSlcbiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgICA6IHRoaXMuJHNsb3RzLmRlZmF1bHRcblxuICAgIHJldHVybiBoKCdkaXYnLCB7XG4gICAgICBzdGF0aWNDbGFzczogJ3YtdHJlZXZpZXcnLFxuICAgICAgY2xhc3M6IHtcbiAgICAgICAgJ3YtdHJlZXZpZXctLWhvdmVyYWJsZSc6IHRoaXMuaG92ZXJhYmxlLFxuICAgICAgICAuLi50aGlzLnRoZW1lQ2xhc3Nlc1xuICAgICAgfVxuICAgIH0sIGNoaWxkcmVuKVxuICB9XG59KVxuIl19