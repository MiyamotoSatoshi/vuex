<template>
  <v-btn
    :icon="smAndDown"
    class="px-0 px-md-2 font-weight-regular"
    variant="text"
  >
    <v-icon icon="mdi-translate" />

    <chevron-down />

    <app-menu
      key="language-menu"
      :items="items"
      activator="parent"
    >
      <template #item="{ item }">
        <v-list-item
          :key="item.locale"
          link
          @click="changeLocale(item.locale)"
        >
          <v-list-item-title v-text="item.title" />
        </v-list-item>
      </template>
    </app-menu>
  </v-btn>
</template>

<script lang="ts">
  // Components
  import AppMenu from '@/components/app/menu/Menu.vue'
  import ChevronDown from '@/components/icons/ChevronDown.vue'

  // Composables
  import { useDisplay } from 'vuetify'
  import { useI18n } from 'vue-i18n'
  import { useLocaleStore } from '@/store/locale'
  import { useRoute, useRouter } from 'vue-router'

  // Utilities
  import { computed, defineComponent } from 'vue'

  // Language
  import locales from '@/i18n/locales.json'

  export default defineComponent({
    name: 'LanguageMenu',

    components: { ChevronDown, AppMenu },

    setup () {
      const { t } = useI18n()
      const display = useDisplay()
      const localeStore = useLocaleStore()
      const router = useRouter()
      const route = useRoute()

      return {
        smAndDown: display.smAndDown,
        items: computed(() => ([
          { heading: t('translations') },
          ...locales.filter((locale: { enabled: boolean }) => locale.enabled),
        ])),
        changeLocale: (locale: string) => {
          console.log('click', locale)
          localeStore.locale = locale
          console.log(route.path)
          router.push({ path: route.path.replace(/^\/[a-zA-Z-]+/, `/${locale}`) })
        },
      }
    },
  })
</script>
